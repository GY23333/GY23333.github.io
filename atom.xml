<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>GuoYiçš„åšå®¢</title>
  
  
  <link href="https://gy23333.github.io/atom.xml" rel="self"/>
  
  <link href="https://gy23333.github.io/"/>
  <updated>2025-12-15T16:21:33.790Z</updated>
  <id>https://gy23333.github.io/</id>
  
  <author>
    <name>GuoYi</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>tcpdump</title>
    <link href="https://gy23333.github.io/2025/12/16/tcpdump/"/>
    <id>https://gy23333.github.io/2025/12/16/tcpdump/</id>
    <published>2025-12-15T16:21:33.000Z</published>
    <updated>2025-12-15T16:21:33.790Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>httpsæµé‡æŠ“å–ä¸è§£å¯†</title>
    <link href="https://gy23333.github.io/2025/12/16/https%E6%B5%81%E9%87%8F%E6%8A%93%E5%8F%96%E4%B8%8E%E8%A7%A3%E5%AF%86/"/>
    <id>https://gy23333.github.io/2025/12/16/https%E6%B5%81%E9%87%8F%E6%8A%93%E5%8F%96%E4%B8%8E%E8%A7%A3%E5%AF%86/</id>
    <published>2025-12-15T16:01:51.000Z</published>
    <updated>2025-12-15T16:53:22.561Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>httpsæµé‡æŠ“å–ä¸è§£å¯†</p><a id="more"></a><h1 id="ä½¿ç”¨æœåŠ¡å™¨ç§é’¥è§£å¯†"><a href="#ä½¿ç”¨æœåŠ¡å™¨ç§é’¥è§£å¯†" class="headerlink" title="ä½¿ç”¨æœåŠ¡å™¨ç§é’¥è§£å¯†"></a>ä½¿ç”¨æœåŠ¡å™¨ç§é’¥è§£å¯†</h1><p>æ­¤æ–¹æ³•å±€é™æ€§è¾ƒå¤§ï¼Œä½¿ç”¨äºèƒ½è‡ªå®šä¹‰æœåŠ¡å™¨ä¸”åŠ å¯†ç®€å•çš„æµ‹è¯•åœºæ™¯ã€‚</p><p>èƒ½å¤Ÿä½¿ç”¨æœåŠ¡å™¨ç§é’¥è§£å¯†çš„å¿…è¦æ¡ä»¶ï¼š</p><ul><li>TLSç‰ˆæœ¬å°äºç­‰äº1.2</li><li>å¿…é¡»ä½¿ç”¨RSAå¯†é’¥äº¤æ¢</li><li>ä¸èƒ½ä½¿ç”¨å‰å‘ä¿å¯†</li></ul><h2 id="ç®€æ˜“çš„httpsæœåŠ¡å™¨"><a href="#ç®€æ˜“çš„httpsæœåŠ¡å™¨" class="headerlink" title="ç®€æ˜“çš„httpsæœåŠ¡å™¨"></a>ç®€æ˜“çš„httpsæœåŠ¡å™¨</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http.server</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®</span></span><br><span class="line">CERT_FILE = <span class="string">'server.crt'</span></span><br><span class="line">KEY_FILE = <span class="string">'server.key'</span></span><br><span class="line">PORT = <span class="number">8443</span></span><br><span class="line">BIND_IP = <span class="string">'0.0.0.0'</span>  <span class="comment"># ç›‘å¬æ‰€æœ‰IP</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(sys.argv) &gt; <span class="number">1</span>:</span><br><span class="line">    PORT = int(sys.argv[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆè¯ä¹¦ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰</span></span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(CERT_FILE) <span class="keyword">or</span> <span class="keyword">not</span> os.path.exists(KEY_FILE):</span><br><span class="line">    print(<span class="string">"ç”Ÿæˆè‡ªç­¾åè¯ä¹¦..."</span>)</span><br><span class="line">    ip_address = input(<span class="string">"è¯·è¾“å…¥æœåŠ¡å™¨IPåœ°å€ï¼ˆé»˜è®¤ 127.0.0.1ï¼‰: "</span>) <span class="keyword">or</span> <span class="string">"127.0.0.1"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç”Ÿæˆè¯ä¹¦å‘½ä»¤</span></span><br><span class="line">    subprocess.run([</span><br><span class="line">        <span class="string">'openssl'</span>, <span class="string">'req'</span>, <span class="string">'-x509'</span>, <span class="string">'-newkey'</span>, <span class="string">'rsa:2048'</span>,</span><br><span class="line">        <span class="string">'-keyout'</span>, KEY_FILE, <span class="string">'-out'</span>, CERT_FILE,</span><br><span class="line">        <span class="string">'-days'</span>, <span class="string">'365'</span>, <span class="string">'-nodes'</span>,</span><br><span class="line">        <span class="string">'-subj'</span>, <span class="string">f'/CN=<span class="subst">&#123;ip_address&#125;</span>'</span>,</span><br><span class="line">        <span class="string">'-addext'</span>, <span class="string">f'subjectAltName=IP:<span class="subst">&#123;ip_address&#125;</span>'</span></span><br><span class="line">    ], check=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨HTTPSæœåŠ¡å™¨</span></span><br><span class="line">handler = http.server.SimpleHTTPRequestHandler</span><br><span class="line">httpd = http.server.HTTPServer((BIND_IP, PORT), handler)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒ…è£…ä¸ºHTTPS</span></span><br><span class="line">context = ssl.SSLContext(ssl.PROTOCOL_TLS_SERVER)</span><br><span class="line">context.load_cert_chain(certfile=CERT_FILE, keyfile=KEY_FILE)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¦ç”¨å‰å‘åŠ å¯†</span></span><br><span class="line">context.set_ciphers(<span class="string">'DEFAULT@SECLEVEL=1:!DHE:!ECDHE'</span>)</span><br><span class="line"></span><br><span class="line">httpd.socket = context.wrap_socket(httpd.socket, server_side=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">f"HTTPSæœåŠ¡å™¨å·²å¯åŠ¨"</span>)</span><br><span class="line">print(<span class="string">f"è®¿é—®åœ°å€: https://127.0.0.1:<span class="subst">&#123;PORT&#125;</span>"</span>)</span><br><span class="line">print(<span class="string">f"æˆ–: https://&lt;ä½ çš„IP&gt;:<span class="subst">&#123;PORT&#125;</span>"</span>)</span><br><span class="line">print(<span class="string">f"ä½¿ç”¨è¯ä¹¦: <span class="subst">&#123;CERT_FILE&#125;</span>"</span>)</span><br><span class="line">print(<span class="string">"æ³¨æ„: è¿™æ˜¯è‡ªç­¾åè¯ä¹¦ï¼Œæµè§ˆå™¨ä¼šæ˜¾ç¤ºè­¦å‘Š"</span>)</span><br><span class="line">print(<span class="string">"æŒ‰ Ctrl+C åœæ­¢æœåŠ¡å™¨"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    httpd.serve_forever()</span><br><span class="line"><span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">    print(<span class="string">"\næœåŠ¡å™¨å·²åœæ­¢"</span>)</span><br></pre></td></tr></table></figure><h2 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -kv https:&#x2F;&#x2F;192.168.139.176:8443 --tls-max 1.2</span><br></pre></td></tr></table></figure><p>é™åˆ¶ tls ç‰ˆæœ¬ä¸º 1.2</p><h2 id="æŠ“åŒ…"><a href="#æŠ“åŒ…" class="headerlink" title="æŠ“åŒ…"></a>æŠ“åŒ…</h2><p>æŠ“å–ä¸€æ¬¡è®¿é—®çš„åŒ…åºåˆ—ï¼Œå†™å…¥ pcap ä¸­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tcpdump host &lt;å®¢æˆ·ç«¯IP&gt; and port 8443 -w https.pcap</span><br></pre></td></tr></table></figure><h2 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h2><p>å°† pcap æ–‡ä»¶å¯¼å…¥ wiresharkï¼Œæ­¤æ—¶ https å±‚ä¸ºåŠ å¯†çš„ Application Data</p><p><img src="https://gy-pic.oss-cn-hangzhou.aliyuncs.com/image-20251216004258863.png" alt="image-20251216004258863"></p><p>å³é”®æ·»åŠ  TLS çš„ RSA keys list</p><p><img src="https://gy-pic.oss-cn-hangzhou.aliyuncs.com/image-20251216004458572.png" alt="image-20251216004458572"></p><p>å¡«å…¥æœåŠ¡å™¨ IPã€ç«¯å£ã€httpã€æœåŠ¡å™¨ç§é’¥</p><p><img src="https://gy-pic.oss-cn-hangzhou.aliyuncs.com/image-20251216004656031.png" alt="image-20251216004656031" style="zoom:50%;" /></p><p>å¦‚æ­¤ä¾¿å°†ä¹‹å‰çš„ Application Data è§£å¼€å‡ºé‡Œé¢çš„ http åè®®å±‚</p><p><img src="/Users/guoyi/Library/Application Support/typora-user-images/image-20251216004830275.png" alt="image-20251216004830275"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;httpsæµé‡æŠ“å–ä¸è§£å¯†&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>MacæœåŠ¡å™¨ç¯å¢ƒé…ç½®</title>
    <link href="https://gy23333.github.io/2025/09/13/Mac%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    <id>https://gy23333.github.io/2025/09/13/Mac%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</id>
    <published>2025-09-13T12:32:41.000Z</published>
    <updated>2025-12-15T15:17:18.558Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>æœåŠ¡å™¨æ­å»ºè®°å½•</p><a id="more"></a><h1 id="åŸºç¡€ç¯å¢ƒ"><a href="#åŸºç¡€ç¯å¢ƒ" class="headerlink" title="åŸºç¡€ç¯å¢ƒ"></a>åŸºç¡€ç¯å¢ƒ</h1><h2 id="Command-Line-Tools"><a href="#Command-Line-Tools" class="headerlink" title="Command Line Tools"></a>Command Line Tools</h2><p>Mac çš„å‘½ä»¤è¡Œå¼€å‘è€…åŸºç¡€å·¥å…·åˆé›†ï¼ŒåŒ…æ‹¬ clangã€makeã€gitã€lldbç­‰ç­‰</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcode-select --install</span><br></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤ä¼šè§¦å‘å›¾å½¢åŒ–å®‰è£…ç¨‹åºå¼¹çª—ï¼ˆéœ€ç‚¹å‡»ç¡®è®¤ï¼‰</p><h2 id="Homebrew"><a href="#Homebrew" class="headerlink" title="Homebrew"></a>Homebrew</h2><p>å®˜ç½‘ï¼š<a href="https://brew.sh/zh-cn/" target="_blank" rel="noopener">https://brew.sh/zh-cn/</a></p><p>ä¾èµ– gitï¼Œè¯·å…ˆå®‰è£… Command Line Tools</p><p>å»ºè®®ä½¿ç”¨å›½å†…é•œåƒå®‰è£…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;bin&#x2F;zsh -c &quot;$(curl -fsSL https:&#x2F;&#x2F;gitee.com&#x2F;cunkai&#x2F;HomebrewCN&#x2F;raw&#x2F;master&#x2F;Homebrew.sh)&quot;</span><br></pre></td></tr></table></figure><p>å®‰è£…ç»“æŸåï¼Œæ›´æ–°ç¯å¢ƒå˜é‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source &#x2F;Users&#x2F;XXXX&#x2F;.zprofile</span><br></pre></td></tr></table></figure><h1 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h1><h2 id="htop"><a href="#htop" class="headerlink" title="htop"></a>htop</h2><p>å¢å¼ºç‰ˆ topï¼Œç”¨äºæŸ¥çœ‹å†…å­˜</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install htop</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>htop</code> å‘½ä»¤æŸ¥çœ‹åŠ¨æ€å†…å­˜ä½¿ç”¨æƒ…å†µ</p><h2 id="ncdu"><a href="#ncdu" class="headerlink" title="ncdu"></a>ncdu</h2><p>ç£ç›˜å ç”¨æŸ¥çœ‹å·¥å…·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install ncdu</span><br></pre></td></tr></table></figure><ul><li><code>ncdu</code> æŸ¥çœ‹å½“å‰ç›®å½•</li><li><code>ncdu &lt;PATH&gt;</code> æŸ¥çœ‹æŒ‡å®šç›®å½•</li></ul><h2 id="orbstack"><a href="#orbstack" class="headerlink" title="orbstack"></a>orbstack</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install orbstack</span><br></pre></td></tr></table></figure><p>é•œåƒé…ç½®</p><ol><li>é…ç½®</li><li>é‡å¯ orbstack</li></ol><h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><h2 id="Navidrome"><a href="#Navidrome" class="headerlink" title="Navidrome"></a>Navidrome</h2><p>~/navidrome/docker-compose.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">navidrome:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">deluan/navidrome:latest</span></span><br><span class="line">    <span class="attr">platform:</span> <span class="string">linux/amd64</span></span><br><span class="line">    <span class="attr">user:</span> <span class="number">1000</span><span class="string">:1000</span> <span class="comment"># should be owner of volumes</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"4533:4533"</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment"># Optional: put your config options customization here. Examples:</span></span><br><span class="line">      <span class="attr">ND_BASEURL:</span> <span class="string">/navidrome</span></span><br><span class="line">      <span class="attr">ND_LOGLEVEL:</span> <span class="string">debug</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"./data:/data"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"./music:/music:ro"</span></span><br></pre></td></tr></table></figure><p>docker-compose up -d</p><h2 id="immich"><a href="#immich" class="headerlink" title="immich"></a>immich</h2><p>App ä½ç½®ï¼š<code>~/Apps/immich</code></p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><ol><li><p>æ–°å»º App æ–‡ä»¶å¤¹ï¼Œå¦‚ <code>~/Apps/immich</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~&#x2F;Apps&#x2F;immich</span><br></pre></td></tr></table></figure></li><li><p>ä¸‹è½½ <a href="https://github.com/immich-app/immich/releases/latest/download/docker-compose.yml" target="_blank" rel="noopener"><code>docker-compose.yml</code></a> and <a href="https://github.com/immich-app/immich/releases/latest/download/example.env" target="_blank" rel="noopener"><code>example.env</code></a>ï¼ˆé‡å‘½åä¸º <code>.env</code>ï¼‰æ”¾åˆ° App æ–‡ä»¶å¤¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O docker-compose.yml https:&#x2F;&#x2F;github.com&#x2F;immich-app&#x2F;immich&#x2F;releases&#x2F;latest&#x2F;download&#x2F;docker-compose.yml</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O .env https:&#x2F;&#x2F;github.com&#x2F;immich-app&#x2F;immich&#x2F;releases&#x2F;latest&#x2F;download&#x2F;example.env</span><br></pre></td></tr></table></figure></li><li><p>ç¯å¢ƒé…ç½®ï¼Œç¼–è¾‘ <code>.env</code> æ–‡ä»¶ï¼Œè®¾ç½®å¦‚ç…§ç‰‡ä¸Šä¼ ä½ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPLOAD_LOCATION&#x3D;&#x2F;Volumes&#x2F;Drive-WD&#x2F;immich&#x2F;library</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨å®¹å™¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure></li></ol><p>å®‰è£…å®Œæˆï¼Œåˆ™å¯ä»é»˜è®¤ 2283 ç«¯å£è®¿é—®</p><h1 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h1><h2 id="Nginx-åä»£"><a href="#Nginx-åä»£" class="headerlink" title="Nginx åä»£"></a>Nginx åä»£</h2><h3 id="Nginx-å®‰è£…"><a href="#Nginx-å®‰è£…" class="headerlink" title="Nginx å®‰è£…"></a>Nginx å®‰è£…</h3><ol><li><p>å®‰è£… nginx</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install nginx</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨ nginx</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew services start nginx</span><br></pre></td></tr></table></figure></li><li><p>æµ‹è¯•è®¿é—®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -I http:&#x2F;&#x2F;localhost:8080</span><br></pre></td></tr></table></figure></li></ol><h3 id="Nginx-é…ç½®"><a href="#Nginx-é…ç½®" class="headerlink" title="Nginx é…ç½®"></a>Nginx é…ç½®</h3><p>/opt/homebrew/etc/nginx</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">#user  nobody;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#error_log  logs&#x2F;error.log;</span><br><span class="line">#error_log  logs&#x2F;error.log  notice;</span><br><span class="line">#error_log  logs&#x2F;error.log  info;</span><br><span class="line"></span><br><span class="line">#pid        logs&#x2F;nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application&#x2F;octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span><br><span class="line">    #                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span><br><span class="line">    #                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs&#x2F;access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       8080;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs&#x2F;host.access.log  main;</span><br><span class="line"></span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        location ^~ &#x2F;navidrome&#x2F; &#123;</span><br><span class="line">            proxy_pass http:&#x2F;&#x2F;127.0.0.1:4533&#x2F;navidrome&#x2F;;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">            proxy_set_header X-Forwarded-Protocol $scheme;</span><br><span class="line">            proxy_set_header X-Forwarded-Host $http_host;</span><br><span class="line">            proxy_buffering off;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        location ^~ &#x2F;immich&#x2F; &#123;</span><br><span class="line">            proxy_pass http:&#x2F;&#x2F;127.0.0.1:2283&#x2F;;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">            proxy_set_header X-Forwarded-Protocol $scheme;</span><br><span class="line">            proxy_set_header X-Forwarded-Host $http_host;</span><br><span class="line">            proxy_buffering off;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #error_page  404              &#x2F;404.html;</span><br><span class="line"></span><br><span class="line">        # redirect server error pages to the static page &#x2F;50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   500 502 503 504  &#x2F;50x.html;</span><br><span class="line">        location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    proxy_pass   http:&#x2F;&#x2F;127.0.0.1;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    root           html;</span><br><span class="line">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  &#x2F;scripts$fastcgi_script_name;</span><br><span class="line">        #    include        fastcgi_params;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # deny access to .htaccess files, if Apache&#39;s document root</span><br><span class="line">        # concurs with nginx&#39;s one</span><br><span class="line">        #</span><br><span class="line">        #location ~ &#x2F;\.ht &#123;</span><br><span class="line">        #    deny  all;</span><br><span class="line">        #&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       8000;</span><br><span class="line">    #    listen       somename:8080;</span><br><span class="line">    #    server_name  somename  alias  another.alias;</span><br><span class="line"></span><br><span class="line">    #    location &#x2F; &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # HTTPS server</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       443 ssl;</span><br><span class="line">    #    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    #    ssl_certificate      cert.pem;</span><br><span class="line">    #    ssl_certificate_key  cert.key;</span><br><span class="line"></span><br><span class="line">    #    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">    #    ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    #    ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">    #    location &#x2F; &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line">    include servers&#x2F;*;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Caddy-åä»£"><a href="#Caddy-åä»£" class="headerlink" title="Caddy åä»£"></a>Caddy åä»£</h2><h3 id="å®‰è£…-Caddy"><a href="#å®‰è£…-Caddy" class="headerlink" title="å®‰è£… Caddy"></a>å®‰è£… Caddy</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install caddy</span><br></pre></td></tr></table></figure><p>å®‰è£…ç›®å½•ä¸ºä¸‹æ–‡çš„ <code>/opt/homebrew/Cellar/caddy/2.10.0</code></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">guoyi@mac<span class="literal">-mini</span> ~ % brew install caddy</span><br><span class="line">==&gt; Auto<span class="literal">-updating</span> Homebrew...</span><br><span class="line">Adjust how often this is run with `$HOMEBREW_AUTO_UPDATE_SECS` or disable with</span><br><span class="line">`$HOMEBREW_NO_AUTO_UPDATE=<span class="number">1</span>`. Hide these hints with `$HOMEBREW_NO_ENV_HINTS=<span class="number">1</span>` (see `man brew`).</span><br><span class="line">==&gt; Fetching downloads <span class="keyword">for</span>: caddy</span><br><span class="line">==&gt; Fetching caddy</span><br><span class="line">==&gt; Downloading https://mirrors.aliyun.com/homebrew/homebrew<span class="literal">-bottles</span>/caddy<span class="literal">-2</span>.<span class="number">10.0</span>.arm64_se</span><br><span class="line"><span class="comment">################################################################################### 100.0%</span></span><br><span class="line">==&gt; Pouring caddy<span class="literal">-2</span>.<span class="number">10.0</span>.arm64_sequoia.bottle.<span class="number">1</span>.tar.gz</span><br><span class="line">==&gt; Caveats</span><br><span class="line">When running the provided service, caddy<span class="string">'s data dir will be set as</span></span><br><span class="line"><span class="string">  `/opt/homebrew/var/lib`</span></span><br><span class="line"><span class="string">  instead of the default location found at https://caddyserver.com/docs/conventions#data-directory</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">To start caddy now and restart at login:</span></span><br><span class="line"><span class="string">  brew services start caddy</span></span><br><span class="line"><span class="string">Or, if you don'</span>t want/need a background service you can just run:</span><br><span class="line">  XDG_DATA_HOME=<span class="string">"/opt/homebrew/var/lib"</span> HOME=<span class="string">"/opt/homebrew/var/lib"</span> /opt/homebrew/opt/caddy/bin/caddy run -<span class="literal">-config</span> /opt/homebrew/etc/Caddyfile</span><br><span class="line">==&gt; Summary</span><br><span class="line">ğŸº  /opt/homebrew/Cellar/caddy/<span class="number">2.10</span>.<span class="number">0</span>: <span class="number">39</span> files, <span class="number">39.5</span>MB</span><br><span class="line">==&gt; Running `brew cleanup caddy`...</span><br><span class="line">Disable this behaviour by setting `HOMEBREW_NO_INSTALL_CLEANUP=<span class="number">1</span>`.</span><br><span class="line">Hide these hints with `HOMEBREW_NO_ENV_HINTS=<span class="number">1</span>` (see `man brew`).</span><br><span class="line">==&gt; No outdated dependents to upgrade!</span><br><span class="line">==&gt; Caveats</span><br><span class="line">zsh completions have been installed to:</span><br><span class="line">  /opt/homebrew/share/zsh/site<span class="literal">-functions</span></span><br></pre></td></tr></table></figure><p>åœ¨å®‰è£…ç›®å½•ä¸‹ï¼Œå³å¯æ‰¾åˆ°ç›¸åº”çš„æœåŠ¡é…ç½® <code>homebrew.mxcl.caddy.plist</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">plist</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//Apple//DTD PLIST 1.0//EN"</span> <span class="meta-string">"http://www.apple.com/DTDs/PropertyList-1.0.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">"1.0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>EnvironmentVariables<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">key</span>&gt;</span>HOME<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>/opt/homebrew/var/lib<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">key</span>&gt;</span>XDG_DATA_HOME<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>/opt/homebrew/var/lib<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>KeepAlive<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>Label<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>homebrew.mxcl.caddy<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>LimitLoadToSessionType<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>Aqua<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>Background<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>LoginWindow<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>StandardIO<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>System<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>ProgramArguments<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>/opt/homebrew/opt/caddy/bin/caddy<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>run<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>--config<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">string</span>&gt;</span>/opt/homebrew/etc/Caddyfile<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>RunAtLoad<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>StandardErrorPath<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>/opt/homebrew/var/log/caddy.log<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>StandardOutPath<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>/opt/homebrew/var/log/caddy.log<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°å…¶ä¸­çš„é»˜è®¤é…ç½®è·¯å¾„ï¼š<code>/opt/homebrew/etc/Caddyfile</code>ï¼Œå½“å‰è¿˜æ²¡æœ‰è¯¥æ–‡ä»¶ï¼Œä¹Ÿæ²¡æœ‰å¯åŠ¨æœåŠ¡ï¼Œéœ€è¦ç¼–å†™å®Œé…ç½®æ–‡ä»¶åï¼Œå†å¯åŠ¨æœåŠ¡</p><h3 id="Caddyfile-é…ç½®æ–‡ä»¶"><a href="#Caddyfile-é…ç½®æ–‡ä»¶" class="headerlink" title="Caddyfile é…ç½®æ–‡ä»¶"></a>Caddyfile é…ç½®æ–‡ä»¶</h3><p>/opt/homebrew/Cellar/caddy/2.10.0</p><p>brew services start caddy</p><h2 id="cpolar-å†…ç½‘ç©¿é€"><a href="#cpolar-å†…ç½‘ç©¿é€" class="headerlink" title="cpolar å†…ç½‘ç©¿é€"></a>cpolar å†…ç½‘ç©¿é€</h2><p><a href="https://www.cpolar.com/blog/cpolar-quick-start-tutorial-macos-series" target="_blank" rel="noopener">macos cpolar ä½¿ç”¨è¯´æ˜</a></p><h3 id="cpolar-å®‰è£…"><a href="#cpolar-å®‰è£…" class="headerlink" title="cpolar å®‰è£…"></a>cpolar å®‰è£…</h3><ol><li><p>å®‰è£… cpolar</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew tap probezy&#x2F;core &amp;&amp; brew install cpolar</span><br></pre></td></tr></table></figure></li><li><p>Token è®¤è¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cpolar authtoken xxxxxxx</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£… cpolar æœåŠ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cpolar service install</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨ cpolar æœåŠ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cpolar service start</span><br></pre></td></tr></table></figure></li><li><p>æœ¬åœ°ç™»å…¥ <a href="http://127.0.0.1:9200/" target="_blank" rel="noopener">http://127.0.0.1:9200/</a></p></li></ol><h2 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h2><p>è®¾ç½® 22 ç«¯å£ tcp éš§é“å</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh &lt;UserName&gt;@3.tcp.cpolar.top -p &lt;Port&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœåŠ¡å™¨æ­å»ºè®°å½•&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>navidrome</title>
    <link href="https://gy23333.github.io/2025/09/08/navidrome/"/>
    <id>https://gy23333.github.io/2025/09/08/navidrome/</id>
    <published>2025-09-08T05:37:41.000Z</published>
    <updated>2025-09-15T18:00:43.817Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><a id="more"></a><p>~/navidrome/docker-compose.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">navidrome:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">deluan/navidrome:latest</span></span><br><span class="line">    <span class="attr">platform:</span> <span class="string">linux/amd64</span></span><br><span class="line">    <span class="attr">user:</span> <span class="number">1000</span><span class="string">:1000</span> <span class="comment"># should be owner of volumes</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"4533:4533"</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment"># Optional: put your config options customization here. Examples:</span></span><br><span class="line">      <span class="attr">ND_LOGLEVEL:</span> <span class="string">debug</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"./data:/data"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"./music:/music:ro"</span></span><br></pre></td></tr></table></figure><p>docker-compose up -d</p><p><a href="https://www.navidrome.org" target="_blank" rel="noopener">https://www.navidrome.org</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Google Maglev</title>
    <link href="https://gy23333.github.io/2025/08/29/Google-Maglev/"/>
    <id>https://gy23333.github.io/2025/08/29/Google-Maglev/</id>
    <published>2025-08-28T17:18:22.000Z</published>
    <updated>2025-09-05T05:55:53.956Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>Google ã€ŠMaglev: A Fast and Reliable Software Network Load Balancerã€‹é˜…è¯»ç¬”è®°ã€‚</p><a id="more"></a><h1 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h1><p>Maglev æ˜¯ Google ä¸€ä¸ªé«˜æ€§èƒ½è½¯ä»¶ç½‘ç»œ LBã€‚ç½‘ç»œè·¯ç”±é€šè¿‡ ECMP å°†æµé‡å¹³å‡åˆ†é…ç»™ Maglev èŠ‚ç‚¹ï¼Œæ¯ä¸ª Maglev èŠ‚ç‚¹å°†åŒ…åŒ¹é…åˆ°å¯¹åº”çš„æœåŠ¡ï¼Œå¹¶å¹³å‡è½¬å‘æœåŠ¡çš„åç«¯ã€‚</p><p>Maglev çš„æ ¸å¿ƒç‰¹æ€§æ˜¯ä¸€è‡´æ€§ hash å’Œè¿æ¥è·Ÿè¸ªè¡¨ã€‚</p><h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>ä¼ ç»Ÿçš„ç”±ç¡¬ä»¶å®ç°çš„ LB å­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼š</p><ul><li>å¯æ‰©å±•æ€§å—åˆ°å•ä¸ªå•å…ƒçš„æœ€å¤§å®¹é‡é™åˆ¶ï¼Œæ— æ³•è·Ÿä¸Šä¸šåŠ¡æµé‡çš„å¢é•¿</li><li>æ— æ³•é«˜å¯ç”¨ï¼Œè™½ç„¶éƒ¨ç½²æ—¶ä¼šåšä¸»å¤‡ï¼Œä½†ä»…èƒ½æä¾› 1+1å†—ä½™</li><li></li></ul><p><img src="/Users/guoyi/Library/Application Support/typora-user-images/image-20250905135235582.png" alt="image-20250905135235582" style="zoom:50%;" /></p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><a href="https://static.googleusercontent.com/media/research.google.com/zh-CN//pubs/archive/44824.pdf" target="_blank" rel="noopener">Maglev: A Fast and Reliable Software Network Load Balancer</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;Google ã€ŠMaglev: A Fast and Reliable Software Network Load Balancerã€‹é˜…è¯»ç¬”è®°ã€‚&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>Go å•å…ƒæµ‹è¯•</title>
    <link href="https://gy23333.github.io/2025/08/20/Go-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"/>
    <id>https://gy23333.github.io/2025/08/20/Go-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/</id>
    <published>2025-08-20T15:32:06.000Z</published>
    <updated>2025-08-20T18:46:10.282Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>Go å•å…ƒæµ‹è¯•</p><a id="more"></a><h1 id="init-å‡½æ•°"><a href="#init-å‡½æ•°" class="headerlink" title="init å‡½æ•°"></a><code>init</code> å‡½æ•°</h1><h1 id="testify-æ–­è¨€åº“"><a href="#testify-æ–­è¨€åº“" class="headerlink" title="testify æ–­è¨€åº“"></a>testify æ–­è¨€åº“</h1><p>å®‰è£…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go get github.com&#x2F;stretchr&#x2F;testify&#x2F;assert</span><br><span class="line">go get github.com&#x2F;stretchr&#x2F;testify&#x2F;require</span><br></pre></td></tr></table></figure><h2 id="assert-VS-require"><a href="#assert-VS-require" class="headerlink" title="assert VS require"></a><code>assert</code> VS <code>require</code></h2><h1 id="Table-Driven-Unit-Test"><a href="#Table-Driven-Unit-Test" class="headerlink" title="Table Driven Unit Test"></a>Table Driven Unit Test</h1><p>å¤šç”¨ä¾‹åœºæ™¯æ¨èä½¿ç”¨ Table Driven Unit Testã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestFunctionUnderTest</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">testCases := []<span class="keyword">struct</span> &#123;</span><br><span class="line">name        <span class="keyword">string</span></span><br><span class="line">input       <span class="keyword">string</span></span><br><span class="line">expect      <span class="keyword">string</span></span><br><span class="line">wantErr     <span class="keyword">bool</span></span><br><span class="line">errContains <span class="keyword">string</span></span><br><span class="line">&#125;&#123;</span><br><span class="line">&#123;name1, input1, expect1, wantErr1, errContains1&#125;,</span><br><span class="line">&#123;name2, input2, expect2, wantErr2, errContains2&#125;,</span><br><span class="line">&#123;name3, input3, expect3, wantErr3, errContains3&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, tt := <span class="keyword">range</span> testCases &#123;</span><br><span class="line">tt := tt <span class="comment">//å¦‚æœéœ€è¦å­ç”¨ä¾‹é—´å¹¶å‘ï¼Œåˆ™åŠ ä¸Šè¿™ä¸¤è¡Œï¼ˆå±€éƒ¨å˜é‡å‰¯æœ¬ä¿è¯å®‰å…¨å¹¶å‘ï¼‰</span></span><br><span class="line">t.Run(tt.name, <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">t.Parallel() <span class="comment">//å¦‚æœéœ€è¦å­ç”¨ä¾‹é—´å¹¶å‘ï¼Œåˆ™åŠ ä¸Šè¿™ä¸¤è¡Œ</span></span><br><span class="line">actual, err := FunctionUnderTest(tt.input)</span><br><span class="line"><span class="keyword">if</span> tt.wantErr &#123;</span><br><span class="line">require.ErrorContains(t, err, tt.errContains)</span><br><span class="line">assert.Nil(t, actual)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">compareFunction(t, tt.expect, actual)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;Go å•å…ƒæµ‹è¯•&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>Goè¿æ¥æ± </title>
    <link href="https://gy23333.github.io/2025/07/11/Go%E8%BF%9E%E6%8E%A5%E6%B1%A0/"/>
    <id>https://gy23333.github.io/2025/07/11/Go%E8%BF%9E%E6%8E%A5%E6%B1%A0/</id>
    <published>2025-07-10T17:31:10.000Z</published>
    <updated>2025-07-10T17:35:00.326Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>DPDK Exception path æ–¹æ¡ˆï¼šVirtio-user</title>
    <link href="https://gy23333.github.io/2025/04/25/DPDK-Exception-path-%E6%96%B9%E6%A1%88%EF%BC%9AVirtio-user/"/>
    <id>https://gy23333.github.io/2025/04/25/DPDK-Exception-path-%E6%96%B9%E6%A1%88%EF%BC%9AVirtio-user/</id>
    <published>2025-04-24T16:27:50.000Z</published>
    <updated>2025-09-05T05:24:38.077Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>DPDK ä½œä¸ºæ—è·¯å†…æ ¸æ–¹æ¡ˆï¼Œå…¶æ¥å—å’Œè½¬å‘çš„åŒ…å¯ä»¥ä¸ç»è¿‡å†…æ ¸è¿›è¡Œé«˜é€Ÿè½¬å‘ï¼Œä½†å…¶ä¸­å¯èƒ½å­˜åœ¨éƒ¨åˆ†â€œå¼‚å¸¸â€çš„åŒ…ï¼ˆæ¯”å¦‚å‘ç»™è¯¥èŠ‚ç‚¹æœ¬èº«çš„åŒ…ï¼‰ä¸éœ€è¦è½¬å‘ï¼Œè€Œæ˜¯éœ€è¦é€šè¿‡å†…æ ¸å¤„ç†ï¼Œè¿™å°±æ˜¯ Exception pathï¼Œvirtio-user åˆ™å®ç° Exception path çš„æ–¹æ¡ˆä¹‹ä¸€ã€‚</p><a id="more"></a><h1 id="Virtio-user"><a href="#Virtio-user" class="headerlink" title="Virtio-user"></a>Virtio-user</h1><p>Virtio-user ä¸€ç³»åˆ—æ¦‚å¿µåŸæœ¬æ˜¯ç”¨æ¥å¤„ç†è™šæ‹Ÿæœºä¸ä¸»æœºä¹‹é—´çš„ I/Oã€‚</p><ul><li><code>virtio</code>ï¼šå³ virtual I/Oï¼Œç”¨äºè™šæ‹Ÿæœºå’Œä¸»æœºé—´é«˜é€Ÿ I/O æ“ä½œçš„å¼€æ”¾æ ‡å‡†ã€‚</li><li><code>vhost</code>ï¼šä¸»æœºä¸­åŠ é€Ÿ virtio çš„åç«¯é©±åŠ¨å®ç°æ–¹æ¡ˆã€‚æœ€åˆ virtio åœ¨ä¸»æœºä¸­çš„åç«¯å¤„ç†ç”± QEMU è¿›ç¨‹å®ç°ï¼Œåå‡çº§ä¸º vhost åŠ é€Ÿæ–¹æ¡ˆï¼Œvhost åˆåˆ†ä¸ºå†…æ ¸æ€çš„ <code>vhost-net</code> å’Œåœ¨ç”¨æˆ·æ€çš„ <code>vhost-user</code>ã€‚</li><li><code>virtio-net</code>ï¼šåœ¨è™šæ‹Ÿæœºå†…éƒ¨çš„<strong>å‰ç«¯é©±åŠ¨</strong>ï¼Œéµå¾ª virtio æ ‡å‡†æ”¶å‘ç½‘ç»œåŒ…ï¼Œéœ€è¦ä¸»æœºæœ‰å¯¹åº”çš„åç«¯æ¥é…åˆã€‚</li><li><code>vhost-net</code>ï¼šåœ¨ä¸»æœºçš„å†…æ ¸ç©ºé—´çš„<strong>åç«¯é©±åŠ¨</strong>ï¼Œå¯ä»¥å¤„ç†æ¥è‡ªè™šæ‹Ÿæœº <code>virtio-net</code> çš„åŒ…ï¼Œå¹¶å°†åŒ…äº¤ç»™å†…æ ¸ç½‘ç»œåè®®æ ˆã€‚</li><li><code>vhost-user</code>ï¼šåœ¨ä¸»æœºçš„ç”¨æˆ·ç©ºé—´çš„<strong>åç«¯è§„èŒƒ</strong>ï¼Œè§„å®šäº†å¦‚ä½•ç»•è¿‡å†…æ ¸ï¼Œé€šè¿‡ç”¨æˆ·æ€åº”ç”¨ï¼ˆå¦‚ OVS-DPDKï¼‰æ¥å®ç°ä¸€ä¸ªåç«¯é©±åŠ¨ï¼Œç”¨æ¥å¤„ç†æ¥è‡ªè™šæ‹Ÿæœº <code>virtio-net</code> çš„åŒ…</li><li><code>virtio-user</code>ï¼šDPDK å¯¹  <code>virtio-net</code> çš„å…·ä½“å®ç°çš„<strong>åç«¯é©±åŠ¨</strong>ï¼Œåœ¨ä¸»æœºçš„ç”¨æˆ·ç©ºé—´ï¼Œå¦‚é€šè¿‡ DPDK åˆ›å»ºç«¯å£ä¸è™šæ‹Ÿæœºé€šä¿¡ä½¿ç”¨çš„å°±æ˜¯è¿™ç§é©±åŠ¨ã€‚</li></ul><p>ç”±æ­¤ä¾¿æœ‰äº†è™šæ‹Ÿæœºä¸ä¸»æœºä¹‹é—´çš„ I/O çš„ä¸‰ç§åç«¯è·¯å¾„ï¼š</p><ol><li>ä¼ ç»Ÿçš„ QEMU è¿›ç¨‹ï¼šé€Ÿåº¦å¾ˆæ…¢</li><li>å†…æ ¸æ€çš„ vhost-net åç«¯é©±åŠ¨ï¼šé€Ÿåº¦å¿«äº QEMU</li><li>ç”¨æˆ·æ€åŸºäº vhost-user åè®®çš„ virtio-user åç«¯é©±åŠ¨ï¼šé€Ÿåº¦æœ€å¿«</li></ol><p><img src="https://gy-pic.oss-cn-hangzhou.aliyuncs.com/image-20250905014859933.png" alt="image-20250905014859933" style="zoom: 33%;" /></p><h1 id="DPDK-Exception-Path-â€”-Virtio-user"><a href="#DPDK-Exception-Path-â€”-Virtio-user" class="headerlink" title="DPDK Exception Path â€” Virtio_user"></a>DPDK Exception Path â€” Virtio_user</h1><p>Virtio_userï¼Œä½œä¸ºè™šæ‹Ÿè®¾å¤‡ï¼ŒåŸæœ¬æ˜¯ä¸ vhost-user åç«¯ï¼ˆå¦ä¸€ä¸ªè¿›ç¨‹ï¼‰ä¸€èµ·ä½œä¸º IPCï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰ å’Œç”¨æˆ·ç©ºé—´å®¹å™¨ç½‘ç»œçš„é«˜æ€§èƒ½è§£å†³æ–¹æ¡ˆã€‚ä½†åœ¨ Exception Path ä¸­ï¼Œå…¶èˆå¼ƒäº† vhost-user åç«¯ï¼Œè€Œæ˜¯ä¸ vhost-net è¿›è¡Œé€šä¿¡ï¼Œä»è€Œå°†åŒ…è½¬å…¥å†…æ ¸ã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº† Virtio_user ä½œä¸º DPDK Exception Path çš„æ¶æ„ã€‚</p><p>å›¾ä¸­å…±æœ‰ä¸¤æ¡åŒ…è·¯å¾„ï¼š</p><ul><li>Fast Path (<code>NIC &lt;-&gt; other PMDs &lt;-&gt; ETHFEV API &lt;-&gt;</code>)ï¼šåŒ…çš„å¿«é€Ÿè½¬å‘è·¯å¾„ï¼Œ çº¯ç”¨æˆ·æ€è½¬å‘ï¼ŒåŒ…ä»ç½‘å¡é€šè¿‡å„ç§ DPDK çš„ PMD é©±åŠ¨æ”¶å‘ï¼ŒDPDK åº”ç”¨é€šè¿‡è°ƒç”¨å¦‚ <code>rte_eth_rx_burst()</code>å’Œ <code>rte_eth_tx_burst()</code> ç­‰ ETHDEV API æ¥ä¸ PMD é©±åŠ¨äº¤äº’ï¼Œå®ç°åŒ…å¤„ç†åï¼Œä¸ç»å†…æ ¸ï¼Œå¿«é€Ÿè½¬å‡º</li><li>Exception Path (<code>NIC -&gt; other PMDs -&gt; ETHFEV API -&gt; ... -&gt; ETHFEV API -&gt; virtio PMD -&gt; tap -&gt; kernel network stack</code>)ï¼šåŒ…çš„å¼‚å¸¸è·¯å¾„<ul><li>DPDK -&gt; å†…æ ¸ï¼ˆå‘é€è·¯å¾„ï¼‰<ol><li>DPDK åº”ç”¨è°ƒç”¨ <code>rte_eth_tx_burst(virtio_user0, ...)</code> æ§åˆ¶ PMD é©±åŠ¨</li><li>virtio PMD é©±åŠ¨å°†åŒ…é€šè¿‡ vhost åè®®ï¼Œå°†æ•°æ®åŒ…ç»è¿‡ <code>/dev/vhost-net</code> æ–‡ä»¶äº¤ç»™å†…æ ¸çš„ vhost-net é©±åŠ¨</li><li>vhost-net é©±åŠ¨å°†åŒ…å†™å…¥ tap è®¾å¤‡</li><li>å†…æ ¸ç½‘ç»œåè®®æ ˆä¸­ tap è®¾å¤‡ä¸­è¯»åˆ°åŒ…ï¼Œå¼€å§‹å¤„ç†</li></ol></li><li>å†…æ ¸ -&gt; DPDKï¼ˆæ¥æ”¶è·¯å¾„ï¼‰<ol><li>å†…æ ¸ç½‘ç»œåè®®æ ˆå†³å®šå‘ä¸€ä¸ªåŒ…ï¼Œå°†åŒ…å†™å…¥ tap è®¾å¤‡</li><li>vhost-net é©±åŠ¨ä» tap è®¾å¤‡æŠ“å–åŒ…</li><li>vhost-net é©±åŠ¨é€šè¿‡ vhost åè®®å’Œå…±äº«å†…å­˜ï¼Œå°†åŒ…æ”¾åˆ° virtio_user0 çš„æ¥å—é˜Ÿåˆ—</li><li>DPDK åº”ç”¨è°ƒç”¨ <code>rte_eth_rx_burst(virtio_user0, ...)</code> ä» virtio_user0 çš„æ¥å—é˜Ÿåˆ—æ”¶åŒ…</li></ol></li></ul></li></ul><p><img src="https://doc.dpdk.org/guides/_images/virtio_user_as_exception_path.svg" alt=""></p><p>DPDK é€šè¿‡ä¸‹é¢ä»£ç ç¤ºä¾‹æ¥åˆ›å»º virtio_user ç«¯å£</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rte_eal_hotplug_add(<span class="string">"vdev"</span>, <span class="string">"virtio_user0"</span>, <span class="string">"path=/dev/vhost-net"</span>);</span><br></pre></td></tr></table></figure><ul><li><code>rte_eal_hotplug_add</code> å‡½æ•°ç”¨äºåŠ¨æ€æ·»åŠ ä¸€ä¸ªè®¾å¤‡</li><li><code>vdev</code> æŒ‡è¿™ä¸ªè®¾å¤‡çš„ç±»å‹æ˜¯è™šæ‹Ÿè®¾å¤‡ï¼ˆVirtual Deviceï¼‰ï¼Œè€Œä¸æ˜¯ç‰©ç† PCI è®¾å¤‡</li><li><code>virtio_user0</code> æŒ‡å®šè®¾å¤‡åç§°ï¼Œå¯¹åº”å›¾ä¸­çš„ virtio PMDï¼Œä¹‹å DPDK å°±å¯é€šè¿‡<code>rte_eth_tx_burst(virtio_user0, ...)</code> å’Œ <code>rte_eth_rx_burst(virtio_user0, ...)</code> æ¥æ“ä½œè¿™ä¸ªç«¯å£</li><li><code>path=/dev/vhost-net</code> æŒ‡å®šçš„è®¾å¤‡çš„åç«¯è·¯å¾„ï¼Œå³ä½¿ç”¨ vhost-net å†…æ ¸é©±åŠ¨ä¸å†…æ ¸äº¤äº’ï¼Œå¯¹åº”äº†å›¾ä¸­çš„å¯¹ vhost.koï¼ˆvhost-net çš„å†…æ ¸æ¨¡å—ï¼‰çš„ç”¨æˆ·æ€ vhost adapter é€‚é…è¡Œä¸º</li></ul><blockquote><p>æ­¤å¤„æ·»åŠ çš„ <code>virtio_user0</code> è™šæ‹Ÿè®¾å¤‡å¹¶é Linux å†…æ ¸çš„è™šæ‹Ÿç½‘å¡ tapï¼Œè¯¥ <code>virtio_user0</code> æ˜¯ç”¨æˆ·æ€çš„ DPDK çš„ virtio PMD çš„ä¸€ä¸ªè™šæ‹Ÿç«¯å£ï¼Œtap æ˜¯ä¸ä¹‹åœ¨å†…æ ¸å¯¹åº”çš„é‚£ç§è™šæ‹Ÿç½‘å¡ï¼Œå¯ä»¥åŒæ ·å‘½åä¸º virtio_user0ï¼Œä½†ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿ã€‚</p></blockquote><h1 id="Virtio-user-Exception-Path-ç¤ºä¾‹"><a href="#Virtio-user-Exception-Path-ç¤ºä¾‹" class="headerlink" title="Virtio-user Exception Path ç¤ºä¾‹"></a>Virtio-user Exception Path ç¤ºä¾‹</h1><ol><li>DPDK ä»ç‰©ç†ç½‘å¡çš„ RX å–ä¸‹åŒ…</li><li>DPDK åˆ¤æ–­æ”¶åŒ…æ˜¯å¦èµ° Exception Path</li><li>å¦‚æœæ˜¯èµ° Exception Path çš„åŒ…ï¼ŒDPDK å°†å…¶æ”¾åˆ° EP ring ä¸­ï¼Œä¹‹åç»Ÿä¸€å‘åˆ° virtio_user0 çš„ TXï¼ˆæ¨èä½¿ç”¨ä¸€ä¸ª ring æ¥ä½œä¸ºä¸­é—´ç¼“å†²ï¼‰</li><li>virtio_user0 é€šè¿‡ vhost-net å°†åŒ…å‘åˆ°å†…æ ¸åè®®æ ˆï¼Œæœ€åäº¤ç»™ç›¸åº”ç”¨æˆ·æ€è¿›ç¨‹</li><li>ç”¨æˆ·æ€è¿›ç¨‹æ”¶åŒ…åï¼Œå°†å“åº”çš„å›åŒ…äº¤ç»™å†…æ ¸åè®®æ ˆ</li><li>vhost-net å°†å›åŒ…æ”¾åˆ° virtio_user0 çš„ RX</li><li>DPDK ä» virtio_user0 çš„ RX æ”¶åŒ…ï¼Œå¹¶é€šè¿‡ç‰©ç†ç½‘å¡çš„ TX å‘å‡º</li></ol><p>æ³¨ï¼šRXã€TX éƒ½æ˜¯ç›¸å¯¹ DPDK è€Œè¨€çš„</p><p><img src="https://gy-pic.oss-cn-hangzhou.aliyuncs.com/20250905030911.png" alt=""></p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><a href="https://doc.dpdk.org/guides/howto/virtio_user_as_exception_path.html" target="_blank" rel="noopener">Virtio_user as Exception Path</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;DPDK ä½œä¸ºæ—è·¯å†…æ ¸æ–¹æ¡ˆï¼Œå…¶æ¥å—å’Œè½¬å‘çš„åŒ…å¯ä»¥ä¸ç»è¿‡å†…æ ¸è¿›è¡Œé«˜é€Ÿè½¬å‘ï¼Œä½†å…¶ä¸­å¯èƒ½å­˜åœ¨éƒ¨åˆ†â€œå¼‚å¸¸â€çš„åŒ…ï¼ˆæ¯”å¦‚å‘ç»™è¯¥èŠ‚ç‚¹æœ¬èº«çš„åŒ…ï¼‰ä¸éœ€è¦è½¬å‘ï¼Œè€Œæ˜¯éœ€è¦é€šè¿‡å†…æ ¸å¤„ç†ï¼Œè¿™å°±æ˜¯ Exception pathï¼Œvirtio-user åˆ™å®ç° Exception path çš„æ–¹æ¡ˆä¹‹ä¸€ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="DPDK" scheme="https://gy23333.github.io/categories/DPDK/"/>
    
    
    <category term="DPDK" scheme="https://gy23333.github.io/tags/DPDK/"/>
    
  </entry>
  
  <entry>
    <title>NUMA éä¸€è‡´æ€§å†…å­˜è®¿é—®</title>
    <link href="https://gy23333.github.io/2025/04/17/NUMA-%E9%9D%9E%E4%B8%80%E8%87%B4%E6%80%A7%E5%86%85%E5%AD%98%E8%AE%BF%E9%97%AE/"/>
    <id>https://gy23333.github.io/2025/04/17/NUMA-%E9%9D%9E%E4%B8%80%E8%87%B4%E6%80%A7%E5%86%85%E5%AD%98%E8%AE%BF%E9%97%AE/</id>
    <published>2025-04-17T15:46:48.000Z</published>
    <updated>2025-04-24T16:28:38.450Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>NUMAï¼ˆNon-Uniform Memory Accessï¼Œéä¸€è‡´æ€§å†…å­˜è®¿é—®ï¼‰æ˜¯ä¸€ç§å¤š CPU è®¡ç®—æœºæ¶æ„ã€‚éä¸€è‡´æ€§ï¼Œè¡¨ç¤º CPU è®¿é—®ä¸åŒå†…å­˜çš„æ˜¯æ—¶é—´ä¸Šçš„ä¸ä¸€è‡´ï¼Œè®¿é—®æœ¬åœ°å†…å­˜å¿«äºéæœ¬åœ°å†…å­˜ã€‚</p><a id="more"></a><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>æ—©æœŸå¤š CPU è®¿é—®å†…å­˜é‡‡ç”¨ SMP ï¼ˆSymmetric Multi-Processorï¼‰æ¶æ„ï¼Œå³ï¼š<strong>æ‰€æœ‰ CPU é€šè¿‡åŒä¸€æ¡æ€»çº¿å…±äº«è®¿é—®ç›¸åŒçš„å†…å­˜</strong>ï¼Œæ‰€æœ‰ CPU è®¿é—®å†…å­˜çš„é€Ÿåº¦éƒ½æ˜¯ç›¸åŒçš„ã€‚</p><p><img src="https://gy-pic.oss-cn-hangzhou.aliyuncs.com/image-20250418000257117.png" alt="image-20250418000257117" style="zoom:50%;" /></p><p>ä½†éšç€ CPU æ•°é‡çš„å¢åŠ ï¼Œä½¿ç”¨ç›¸åŒæ€»çº¿å’Œèµ„æºå¿…ç„¶å¯¼è‡´è®¿é—®å†²çªï¼Œä»è€Œé€ æˆ CPU åˆ©ç”¨ç‡é™ä½ã€‚</p><h1 id="NUMA"><a href="#NUMA" class="headerlink" title="NUMA"></a>NUMA</h1><p>NUMAï¼ˆNon-Uniform Memory Accessï¼Œéä¸€è‡´æ€§å†…å­˜è®¿é—®ï¼‰å°† CPU åˆ’åˆ†åˆ°å¤šä¸ª NUMA Nodeï¼Œæ¯ä¸ª Node éƒ½æœ‰ç‹¬ç«‹çš„ Bus å’Œ Memoryã€‚Node ä¹‹é—´é€šè¿‡ QPI æ€»çº¿ï¼ˆé«˜é€Ÿäº’è”æ€»çº¿ï¼‰äº’é€šã€‚</p><p><img src="https://gy-pic.oss-cn-hangzhou.aliyuncs.com/image-20250418002625551.png" alt="image-20250418002625551" style="zoom:50%;" /></p><p>CPU è®¿é—®ä¸åŒçš„ Memory é€Ÿåº¦ä¸åŒï¼Œè®¿é—®æœ¬åœ° Memory çš„é€Ÿåº¦å¿«äºéæœ¬åœ° Memoryã€‚</p><h1 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h1><p>Socket æ˜¯ CPU çš„ç‰©ç†æ’æ§½ï¼Œä¸€ä¸ª Socket å¯ä»¥æ’å…¥å¤šä¸ª CPUï¼Œé€šå¸¸ä¸€ä¸ª Socket å°±æ˜¯ä¸€ä¸ª NUMA Nodeã€‚</p><h1 id="æŸ¥çœ‹å‘½ä»¤"><a href="#æŸ¥çœ‹å‘½ä»¤" class="headerlink" title="æŸ¥çœ‹å‘½ä»¤"></a>æŸ¥çœ‹å‘½ä»¤</h1><ul><li><p>æŸ¥çœ‹ CPU ç›¸å…³ä¿¡æ¯</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2404:/<span class="comment"># lscpu</span></span><br><span class="line">Architecture:             aarch64</span><br><span class="line">  CPU op<span class="literal">-mode</span>(s):         <span class="number">64</span><span class="literal">-bit</span></span><br><span class="line">  Byte Order:             Little Endian</span><br><span class="line">CPU(s):                   <span class="number">3</span></span><br><span class="line">  On<span class="literal">-line</span> CPU(s) list:    <span class="number">0</span><span class="literal">-2</span></span><br><span class="line">Vendor ID:                Apple</span><br><span class="line">  BIOS Vendor ID:         Apple</span><br><span class="line">  Model name:             -</span><br><span class="line">    BIOS Model name:      Apple silicon  CPU <span class="selector-tag">@</span> <span class="number">0.0</span>GHz</span><br><span class="line">    BIOS CPU family:      <span class="number">280</span></span><br><span class="line">    Model:                <span class="number">0</span></span><br><span class="line">    Thread(s) per core:   <span class="number">1</span></span><br><span class="line">    Core(s) per socket:   <span class="number">3</span>  <span class="comment"># æ¯ä¸ª socket é‡Œæœ‰ 3 ä¸ª CPU</span></span><br><span class="line">    Socket(s):            <span class="number">1</span>  <span class="comment"># ä¸€å…± 1 ä¸ª socket</span></span><br><span class="line">    Stepping:             <span class="number">0</span>x0</span><br><span class="line">    BogoMIPS:             <span class="number">48.00</span></span><br><span class="line">    Flags:                fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt fcma lrcpc dcpop s</span><br><span class="line">                          ha3 asimddp sha512 asimdfhm dit uscat ilrcpc flagm sb paca pacg dcpodp sve2 flagm2 frint svei8mm svebf1</span><br><span class="line">                          <span class="number">6</span> smei16i64 smef64f64 smei8i32 smef16f32 smeb16f32 smef32f32 sme2 smei16i32 smebi32i32</span><br><span class="line">Caches (sum of all):</span><br><span class="line">  L1d:                    <span class="number">384</span> KiB (<span class="number">3</span> instances)</span><br><span class="line">  L1i:                    <span class="number">576</span> KiB (<span class="number">3</span> instances)</span><br><span class="line">  L2:                     <span class="number">48</span> MiB (<span class="number">3</span> instances)</span><br><span class="line">NUMA:</span><br><span class="line">  NUMA node(s):           <span class="number">1</span>    <span class="comment"># ä¸€å…± 1 ä¸ª NUMA node</span></span><br><span class="line">  NUMA node0 CPU(s):      <span class="number">0</span><span class="literal">-2</span>  <span class="comment"># 0ï½2 å· CPU åœ¨ NUMA node0 ä¸­</span></span><br><span class="line">Vulnerabilities:</span><br><span class="line">  Gather <span class="keyword">data</span> sampling:   Not affected</span><br><span class="line">  Itlb multihit:          Not affected</span><br><span class="line">  L1tf:                   Not affected</span><br><span class="line">  Mds:                    Not affected</span><br><span class="line">  Meltdown:               Not affected</span><br><span class="line">  Mmio stale <span class="keyword">data</span>:        Not affected</span><br><span class="line">  Reg file <span class="keyword">data</span> sampling: Not affected</span><br><span class="line">  Retbleed:               Not affected</span><br><span class="line">  Spec rstack overflow:   Not affected</span><br><span class="line">  Spec store bypass:      Vulnerable</span><br><span class="line">  Spectre v1:             Mitigation; __user pointer sanitization</span><br><span class="line">  Spectre v2:             Not affected</span><br><span class="line">  Srbds:                  Not affected</span><br><span class="line">  Tsx async abort:        Not affected</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ NUMA ä¿¡æ¯</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2404:/<span class="comment"># numactl --hardware</span></span><br><span class="line">available: <span class="number">1</span> nodes (<span class="number">0</span>)</span><br><span class="line">node <span class="number">0</span> cpus: <span class="number">0</span> <span class="number">1</span> <span class="number">2</span></span><br><span class="line">node <span class="number">0</span> size: <span class="number">3902</span> MB</span><br><span class="line">node <span class="number">0</span> free: <span class="number">72</span> MB</span><br><span class="line">node distances:</span><br><span class="line">node   <span class="number">0</span></span><br><span class="line">  <span class="number">0</span>:  <span class="number">10</span></span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ CPU ä»¥åŠå…¶å¯¹åº”çš„ NODEã€SOCKETã€CORE</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2404:/<span class="comment"># lscpu -p=CPU,NODE,SOCKET,CORE</span></span><br><span class="line"><span class="comment"># The following is the parsable format, which can be fed to other</span></span><br><span class="line"><span class="comment"># programs. Each different item in every column has an unique ID</span></span><br><span class="line"><span class="comment"># starting usually from zero.</span></span><br><span class="line"><span class="comment"># CPU,Node,Socket,Core</span></span><br><span class="line"><span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>  <span class="comment"># é€»è¾‘CPU0 -&gt; NUMA node0 -&gt; Socket0 -&gt; ç‰©ç†æ ¸å¿ƒ0</span></span><br><span class="line"><span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span></span><br><span class="line"><span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;NUMAï¼ˆNon-Uniform Memory Accessï¼Œéä¸€è‡´æ€§å†…å­˜è®¿é—®ï¼‰æ˜¯ä¸€ç§å¤š CPU è®¡ç®—æœºæ¶æ„ã€‚éä¸€è‡´æ€§ï¼Œè¡¨ç¤º CPU è®¿é—®ä¸åŒå†…å­˜çš„æ˜¯æ—¶é—´ä¸Šçš„ä¸ä¸€è‡´ï¼Œè®¿é—®æœ¬åœ°å†…å­˜å¿«äºéæœ¬åœ°å†…å­˜ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Linux" scheme="https://gy23333.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>DPDK å†…å­˜ç®¡ç†</title>
    <link href="https://gy23333.github.io/2025/04/17/DPDK-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"/>
    <id>https://gy23333.github.io/2025/04/17/DPDK-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/</id>
    <published>2025-04-17T15:32:38.000Z</published>
    <updated>2025-07-10T17:58:44.551Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><a id="more"></a><h1 id="rte-mempool"><a href="#rte-mempool" class="headerlink" title="rte_mempool"></a>rte_mempool</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="DPDK" scheme="https://gy23333.github.io/categories/DPDK/"/>
    
    
    <category term="DPDK" scheme="https://gy23333.github.io/tags/DPDK/"/>
    
  </entry>
  
  <entry>
    <title>DPDK example: å‘½ä»¤è¡Œå‚æ•°è§£æ</title>
    <link href="https://gy23333.github.io/2025/04/14/DPDK-example-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90/"/>
    <id>https://gy23333.github.io/2025/04/14/DPDK-example-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90/</id>
    <published>2025-04-13T18:05:33.000Z</published>
    <updated>2025-04-23T13:35:03.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>DPDK example: å‘½ä»¤è¡Œå‚æ•°è§£æ</p><a id="more"></a><h2 id="å‚æ•°è¯»å–"><a href="#å‚æ•°è¯»å–" class="headerlink" title="å‚æ•°è¯»å–"></a>å‚æ•°è¯»å–</h2><p>åˆå§‹åŒ– EALï¼Œå¹¶è·å–å‰©ä½™å‚æ•°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;getopt.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rte_eal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rte_common.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">cfgs</span> &#123;</span></span><br><span class="line"><span class="keyword">uint32_t</span> num;</span><br><span class="line"><span class="keyword">char</span> *<span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">bool</span> mode;</span><br><span class="line">&#125; <span class="keyword">cfgs_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> &#123;</span><br><span class="line">CMD_OPT_NUM = <span class="number">1</span>,</span><br><span class="line">CMD_OPT_STRING,</span><br><span class="line">CMD_OPT_MODE,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">option</span> <span class="title">long_options</span>[] = &#123;</span></span><br><span class="line">&#123;<span class="string">"help"</span>, no_argument, <span class="literal">NULL</span>, <span class="string">'h'</span>&#125;,</span><br><span class="line">&#123;<span class="string">"num"</span>, required_argument, <span class="literal">NULL</span>, CMD_OPT_NUM&#125;,</span><br><span class="line">&#123;<span class="string">"string"</span>, required_argument, <span class="literal">NULL</span>, CMD_OPT_STRING&#125;,</span><br><span class="line">&#123;<span class="string">"mode"</span>, no_argument, <span class="literal">NULL</span>, CMD_OPT_MODE&#125;,</span><br><span class="line"></span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print_usage</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *prgname)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s [OPTIONS]\n"</span>, prgname);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"--help                 Help\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"--num &lt;uint32&gt;         Num\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"--string &lt;string&gt;      String\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"--mode                 Mode\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">str_to_uint32</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *str, <span class="keyword">uint32_t</span> *num)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *endptr;</span><br><span class="line">    errno = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> val = strtoul(str, &amp;endptr, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (errno != <span class="number">0</span> || *endptr != <span class="string">'\0'</span> || val &gt; UINT32_MAX) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">*num = (<span class="keyword">uint32_t</span>)val;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">uint32_t</span> <span class="title">parse_num</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *arg)</span> </span>&#123;</span><br><span class="line"><span class="keyword">uint32_t</span> value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (str_to_uint32(arg, &amp;value))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line">rte_exit(EXIT_FAILURE, <span class="string">"Failed to parse num\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">cfgs_t</span> <span class="title">parse_args</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line"><span class="keyword">cfgs_t</span> cfgs;</span><br><span class="line"><span class="keyword">char</span> *prgname = argv[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®é»˜è®¤å€¼</span></span><br><span class="line">cfgs.num = <span class="number">0</span>;</span><br><span class="line">cfgs.<span class="built_in">string</span> = <span class="literal">NULL</span>;</span><br><span class="line">cfgs.mode = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> option_id;</span><br><span class="line"><span class="keyword">while</span> ((option_id = getopt_long_only(argc, argv, <span class="string">"h"</span>, long_options, <span class="literal">NULL</span>)) != <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">switch</span> (option_id)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'h'</span>:</span><br><span class="line">print_usage(prgname);</span><br><span class="line">rte_exit(EXIT_SUCCESS, <span class="string">"Exit APP\n"</span>);</span><br><span class="line"><span class="keyword">case</span> CMD_OPT_NUM:</span><br><span class="line">cfgs.num = parse_num(optarg);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> CMD_OPT_STRING:</span><br><span class="line">cfgs.<span class="built_in">string</span> = optarg;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> CMD_OPT_MODE:</span><br><span class="line">cfgs.mode = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">print_usage(prgname);</span><br><span class="line">rte_exit(EXIT_FAILURE, <span class="string">"Invalid command line parameter\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> cfgs;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span>&#123;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–EAL</span></span><br><span class="line"><span class="keyword">int</span> ret;</span><br><span class="line">ret = rte_eal_init(argc, argv);</span><br><span class="line"><span class="keyword">if</span> (ret &lt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">rte_exit(EXIT_FAILURE, <span class="string">"Failed to init eal"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å»é™¤æ‰è¢«EALä½¿ç”¨äº†çš„å‚æ•°</span></span><br><span class="line">argc -= ret;</span><br><span class="line">argv += ret;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£æå…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="keyword">cfgs_t</span> cfgs = parse_args(argc, argv);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"num:     %d\n"</span>, cfgs.num);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"string:  %s\n"</span>, cfgs.<span class="built_in">string</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mode:    %d\n"</span>, cfgs.mode);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Finished initiation\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œ</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2404:/home/guoyi/dpdk<span class="literal">-stable</span><span class="literal">-24</span>.<span class="number">11.1</span>/build<span class="comment"># ./examples/dpdk-playground -- --num 1 --string "abd" --mode</span></span><br><span class="line">EAL: Detected CPU lcores: <span class="number">3</span></span><br><span class="line">EAL: Detected NUMA nodes: <span class="number">1</span></span><br><span class="line">EAL: Detected <span class="keyword">static</span> linkage of DPDK</span><br><span class="line">EAL: Multi<span class="literal">-process</span> socket /var/run/dpdk/rte/mp_socket</span><br><span class="line">EAL: Selected IOVA mode <span class="string">'PA'</span></span><br><span class="line">num:     <span class="number">1</span></span><br><span class="line">string:  abd</span><br><span class="line">mode:    <span class="number">1</span></span><br><span class="line">Finished initiation</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;DPDK example: å‘½ä»¤è¡Œå‚æ•°è§£æ&lt;/p&gt;</summary>
    
    
    
    <category term="DPDK" scheme="https://gy23333.github.io/categories/DPDK/"/>
    
    
    <category term="DPDK" scheme="https://gy23333.github.io/tags/DPDK/"/>
    
  </entry>
  
  <entry>
    <title>Meson æ„å»ºç³»ç»Ÿ</title>
    <link href="https://gy23333.github.io/2025/04/14/Meson-%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/"/>
    <id>https://gy23333.github.io/2025/04/14/Meson-%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/</id>
    <published>2025-04-13T17:51:08.000Z</published>
    <updated>2025-04-15T17:16:48.656Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><a id="more"></a><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><a href="https://meson.pythonlang.cn" target="_blank" rel="noopener">Meson å®˜æ–¹æ–‡æ¡£</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="C/C++" scheme="https://gy23333.github.io/categories/C-C/"/>
    
    
    <category term="C/C++" scheme="https://gy23333.github.io/tags/C-C/"/>
    
    <category term="Meson" scheme="https://gy23333.github.io/tags/Meson/"/>
    
  </entry>
  
  <entry>
    <title>C getopt å‘½ä»¤è¡Œå‚æ•°è§£æ</title>
    <link href="https://gy23333.github.io/2025/04/13/C-getopt-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90/"/>
    <id>https://gy23333.github.io/2025/04/13/C-getopt-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90/</id>
    <published>2025-04-13T06:37:34.000Z</published>
    <updated>2025-04-13T13:17:30.891Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>ä½¿ç”¨ <code>getopt_long_only()</code> è§£æå‘½ä»¤è¡Œå‚æ•°ã€‚</p><a id="more"></a><h1 id="é€‰é¡¹è®¾ç½®"><a href="#é€‰é¡¹è®¾ç½®" class="headerlink" title="é€‰é¡¹è®¾ç½®"></a>é€‰é¡¹è®¾ç½®</h1><h2 id="shortopts-çŸ­é€‰é¡¹"><a href="#shortopts-çŸ­é€‰é¡¹" class="headerlink" title="shortopts çŸ­é€‰é¡¹"></a><code>shortopts</code> çŸ­é€‰é¡¹</h2><p>å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šå¯æ¥å—çš„çŸ­é€‰é¡¹ã€‚</p><ul><li>å•ä¸ªå­—ç¬¦ï¼šä¸å¸¦å‚æ•°çš„é€‰é¡¹</li><li>å•ä¸ªå­—ç¬¦ + <code>:</code>ï¼šå¸¦å‚æ•°çš„é€‰é¡¹</li><li>å•ä¸ªå­—ç¬¦ + <code>::</code>ï¼šå¯å¸¦ä¹Ÿå¯ä¸å¸¦å‚æ•°çš„é€‰é¡¹</li></ul><p>å¦‚</p><ul><li><code>ab</code>ï¼š æ”¯æŒä¸¤ä¸ªå•é€‰é¡¹ <code>-a</code>ã€<code>-b</code>ï¼Œä¸”ä¸å¸¦å‚æ•°</li><li><code>a:b</code>ï¼šæ”¯æŒä¸€ä¸ªå¸¦å‚æ•°çš„é€‰é¡¹ <code>-a value</code> å’Œä¸€ä¸ªä¸å¸¦å‚æ•°çš„é€‰é¡¹ <code>-b</code></li><li><code>a::b</code>ï¼šæ”¯æŒä¸€ä¸ªå¯å¸¦å¯ä¸å¸¦å‚æ•°çš„é€‰é¡¹ <code>-a</code>ã€ <code>-a value</code> å’Œä¸€ä¸ªä¸å¸¦å‚æ•°çš„é€‰é¡¹ <code>-b</code></li></ul><h2 id="longopts-é•¿é€‰é¡¹"><a href="#longopts-é•¿é€‰é¡¹" class="headerlink" title="longopts é•¿é€‰é¡¹"></a><code>longopts</code> é•¿é€‰é¡¹</h2><p>option çš„æ•°ç»„ï¼ŒæŒ‡å®šå¯æ¥å—çš„é•¿é€‰é¡¹ã€‚<strong>éœ€ä»¥ <code>{0,0,0,0}</code> ç»“å°¾ä½œä¸ºç»“æŸçš„æ ‡å¿—</strong>ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">option</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *name;</span><br><span class="line">  <span class="comment">/* has_arg can't be an enum because some compilers complain about</span></span><br><span class="line"><span class="comment">     type mismatches in all the code that assumes it is an int.  */</span></span><br><span class="line">  <span class="keyword">int</span> has_arg;</span><br><span class="line">  <span class="keyword">int</span> *flag;</span><br><span class="line">  <span class="keyword">int</span> val;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p><code>name</code>ï¼šé•¿é€‰é¡¹å</p></li><li><p><code>has_arg</code>ï¼šæ˜¯å¦éœ€è¦å‚æ•°</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> no_argument0<span class="comment">//ä¸éœ€è¦å‚æ•°</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> required_argument1<span class="comment">//å¿…é€‰å‚æ•°</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> optional_argument2<span class="comment">//å¯é€‰å‚æ•°</span></span></span><br></pre></td></tr></table></figure></li><li><p><code>flag</code>ï¼šè®¾ç½®ç»“æœå­˜å‚¨æ–¹å¼</p><ul><li>é NULL æ—¶ï¼Œè§£æåˆ°è¿™ä¸ªé•¿é€‰é¡¹æ—¶ä¼šæŠŠ <code>val</code> å€¼æ”¾å…¥å…¶æŒ‡å‘çš„å†…å­˜</li><li>å¦‚æœä¸éœ€è¦ï¼Œåˆ™è®¾ç½®ä¸º NULL</li></ul></li><li><p><code>val</code>ï¼šè§£æè¿”å›å€¼ï¼ˆ<code>flag</code> ä¸º NULL ï¼‰ï¼Œæˆ–è€…è¦è®¾ç½®çš„å€¼ï¼ˆ<code>flag</code> ä¸ä¸º NULL ï¼‰</p><ul><li><code>flag</code> ä¸º NULL æ—¶ï¼Œä¸º <code>getopt_long_only()</code> è§£æé€‰é¡¹çš„è¿”å›å€¼ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„é€‰é¡¹ï¼Œä¸€èˆ¬ç»™ä¸åŒçš„é€‰é¡¹è®¾ç½®ä¸åŒçš„ <code>val</code> ä½œä¸º IDã€‚ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºå¯¹åº”çŸ­é€‰é¡¹çš„å­—ç¬¦ï¼Œç”¨æ¥åŒ¹é…é•¿é€‰é¡¹å’ŒçŸ­é€‰é¡¹</li><li><code>flag</code> ä¸ä¸º NULL æ—¶ï¼ŒæŠŠ <code>val</code> å€¼æ”¾å…¥å…¶æŒ‡å‘çš„å†…å­˜</li></ul></li></ul><h1 id="getopt-long-only"><a href="#getopt-long-only" class="headerlink" title="getopt_long_only()"></a><code>getopt_long_only()</code></h1><p>è§£æä¸€ä¸ª optionï¼Œè¿”å›è¯¥ option çš„ idï¼Œå¹¶å°†è¿™ä¸ª option çš„å€¼å­˜å…¥ optarg ä¸­ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;getopt.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getopt_long_only</span><span class="params">(<span class="keyword">int</span> ___argc, <span class="keyword">char</span> *<span class="keyword">const</span> *___argv, <span class="keyword">const</span> <span class="keyword">char</span> *__shortopts, <span class="keyword">const</span> struct option *__longopts, <span class="keyword">int</span> *__longind)</span></span></span><br></pre></td></tr></table></figure><p>è¾“å…¥å‚æ•°ï¼š</p><ul><li><code>argc</code>ã€<code>argv</code>ï¼šä¸»å‡½æ•°å‚æ•°</li><li><code>shortopts</code>ï¼šçŸ­é€‰é¡¹å­—ç¬¦ä¸²</li><li><code>longopts</code>ï¼šé•¿é€‰é¡¹ç»“æ„ä½“æ•°ç»„</li><li><code>longind</code>ï¼šè¿”å›é•¿é€‰é¡¹åœ¨ <code>longopts</code> ä¸­çš„ç´¢å¼•å€¼ã€‚ä¸€èˆ¬åªç”¨äºè°ƒè¯•ï¼Œæ­£å¸¸æƒ…å†µè¾“å…¥ <code>NULL</code> å³å¯ã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><p>è¿”å›è§£æçš„è¿™ä¸ª option çš„ id</p><ul><li>å¦‚æœè¿™ä¸ª option æ˜¯çŸ­é€‰é¡¹ï¼Œè¿”å›è¯¥çŸ­é€‰é¡¹çš„å­—ç¬¦</li><li>å¦‚æœè¿™ä¸ª option æ˜¯é•¿é€‰é¡¹<ul><li>å¦‚æœ <code>flag</code> ä¸º NULLï¼Œåˆ™è¿”å› <code>val</code> å€¼</li><li>å¦‚æœ <code>flag</code> ä¸ä¸º NULLï¼Œåˆ™è¿”å› 0ï¼Œå¹¶å°† <code>val</code> å€¼æ”¾å…¥ <code>flag</code> æŒ‡é’ˆä¸­</li></ul></li><li>è§£æå®Œæ¯•ï¼Œè¿”å› -1</li></ul><h1 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;getopt.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span></span><br><span class="line">&#123;</span><br><span class="line">    CMD_OPTION_A = <span class="number">1</span>,</span><br><span class="line">    CMD_OPTION_B,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">option</span> <span class="title">long_opts</span>[] = &#123;</span></span><br><span class="line">    &#123;<span class="string">"help"</span>, no_argument, <span class="literal">NULL</span>, <span class="string">'h'</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"option_a"</span>, required_argument, <span class="literal">NULL</span>, CMD_OPTION_A&#125;, <span class="comment">// éœ€è®¾ç½®å‚æ•°çš„ option</span></span><br><span class="line">    &#123;<span class="string">"option_b"</span>, no_argument, <span class="literal">NULL</span>, CMD_OPTION_B&#125;,       <span class="comment">// ä¸è®¾ç½®å‚æ•°çš„ option</span></span><br><span class="line"></span><br><span class="line">    &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print_usage</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *prgname)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s [OPTIONS]\n"</span>, prgname);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"--help                 Help\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"--option_a VALUE       Option A\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"--option_b             Option B\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">parse_args</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> option_id;</span><br><span class="line">    <span class="keyword">char</span> *prgname = argv[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> ((option_id = getopt_long_only(argc, argv, <span class="string">"h"</span>, long_opts, <span class="literal">NULL</span>)) != <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">switch</span> (option_id)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'h'</span>:</span><br><span class="line">            print_usage(prgname);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">case</span> CMD_OPTION_A:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"option A: %s\n"</span>, optarg);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> CMD_OPTION_B:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"set option_b on\n"</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            print_usage(prgname);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret;</span><br><span class="line">    ret = parse_args(argc, argv);</span><br><span class="line">    <span class="keyword">if</span> (ret &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"failed to parse command line parameters\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä½¿ç”¨ &lt;code&gt;getopt_long_only()&lt;/code&gt; è§£æå‘½ä»¤è¡Œå‚æ•°ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="C/C++" scheme="https://gy23333.github.io/categories/C-C/"/>
    
    
  </entry>
  
  <entry>
    <title>Linuxç½‘å¡ç»‘å®š</title>
    <link href="https://gy23333.github.io/2025/03/26/Linux%E7%BD%91%E5%8D%A1%E7%BB%91%E5%AE%9A/"/>
    <id>https://gy23333.github.io/2025/03/26/Linux%E7%BD%91%E5%8D%A1%E7%BB%91%E5%AE%9A/</id>
    <published>2025-03-25T16:36:08.000Z</published>
    <updated>2025-04-15T16:39:49.328Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>Linux NIC Bonding æŠ€æœ¯å¯ä»¥å°†å¤šå¼ ç‰©ç†ç½‘å¡æˆ–è€…è™šæ‹Ÿç½‘å¡ç»‘å®šä¸ºä¸€å¼ è™šæ‹Ÿçš„é€»è¾‘ç½‘å¡ï¼Œä»è€Œå®ç°ç½‘å¡çš„å†—ä½™ã€å¸¦å®½çš„æ‰©å®¹ä»¥åŠè´Ÿè½½å‡è¡¡ã€‚</p><a id="more"></a><h1 id="ç½‘å¡ç»‘å®šçš„ä½œç”¨"><a href="#ç½‘å¡ç»‘å®šçš„ä½œç”¨" class="headerlink" title="ç½‘å¡ç»‘å®šçš„ä½œç”¨"></a>ç½‘å¡ç»‘å®šçš„ä½œç”¨</h1><p>ç½‘å¡ç»‘å®šçš„ä½œç”¨ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹é¢ï¼š</p><ul><li><strong>æä¾›å†—ä½™ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰</strong>ï¼šç½‘å¡ç»‘å®šæœ€ä¸»è¦çš„ä½œç”¨ï¼Œå¦‚ä¸‹å›¾ï¼Œç‰©ç†æœºçš„å¤šå¼ ç‰©ç†ç½‘å¡å¯ä»¥ä¸Šè¿å¤šä¸ªäº¤æ¢æœºï¼Œå°†ç½‘å¡ç»‘å®šä¸ºä¸€å¼ è™šæ‹Ÿç½‘å¡ï¼Œä½¿ç”¨è¯¥ bond è™šæ‹Ÿç½‘å¡ï¼Œå½“å…¶ä¸­ä¸€ä¸ªäº¤æ¢æœºæ•…éšœæ—¶ï¼Œæµé‡å¯ä»¥è‡ªåŠ¨åˆ‡æ¢åˆ°å¦ä¸€ä¸ªäº¤æ¢æœºä¸ç‰©ç†ç½‘å¡ï¼Œæä¾›äº†ç½‘å¡çš„å®¹ç¾èƒ½åŠ›ã€‚</li><li><strong>æé«˜ååé‡</strong>ï¼šç”±äºæ˜¯å¤šå¼ ç½‘å¡è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œbond å‡ºæ¥çš„ç½‘å¡çš„ååé‡ä¹Ÿå¾—åˆ°äº†æå‡ã€‚</li></ul><p><img src="https://gy-pic.oss-cn-hangzhou.aliyuncs.com/image-20250326005558522.png" alt="image-20250326005558522" style="zoom:50%;" /></p><h1 id="ç½‘å¡ç»‘å®šæ¨¡å¼"><a href="#ç½‘å¡ç»‘å®šæ¨¡å¼" class="headerlink" title="ç½‘å¡ç»‘å®šæ¨¡å¼"></a>ç½‘å¡ç»‘å®šæ¨¡å¼</h1><h2 id="Mode-0-â€”-balance-rrï¼ˆè½®è¯¢æ¨¡å¼ï¼‰"><a href="#Mode-0-â€”-balance-rrï¼ˆè½®è¯¢æ¨¡å¼ï¼‰" class="headerlink" title="Mode 0 â€” balance-rrï¼ˆè½®è¯¢æ¨¡å¼ï¼‰"></a>Mode 0 â€” balance-rrï¼ˆè½®è¯¢æ¨¡å¼ï¼‰</h2><p>æ•°æ®åŒ…ä¾æ¬¡é¡ºåºè½®è¯¢æ¯å¼ ç½‘å¡ä¼ è¾“ï¼Œå³ç¬¬1ä¸ªåŒ…èµ° eth0ï¼Œä¸‹ä¸€ä¸ªåŒ…å°±èµ° eth1â€¦.ä¸€ç›´è½®è¯¢ä¸‹å»ã€‚</p><h2 id="Mode-1-â€”-active-backupï¼ˆä¸»å¤‡æ¨¡å¼ï¼‰"><a href="#Mode-1-â€”-active-backupï¼ˆä¸»å¤‡æ¨¡å¼ï¼‰" class="headerlink" title="Mode 1 â€” active-backupï¼ˆä¸»å¤‡æ¨¡å¼ï¼‰"></a>Mode 1 â€” active-backupï¼ˆä¸»å¤‡æ¨¡å¼ï¼‰</h2><p>åªæœ‰ä¸€å¼ ç½‘å¡ä½œä¸ºä¸»ï¼Œæ‰¿æ¥æµé‡ï¼Œå½“ä¸»ç½‘å¡å®•æœºåï¼Œå¯ç”¨å¤‡ç½‘å¡ã€‚</p><h2 id="Mode-2-â€”-balance-xorï¼ˆå¼‚æˆ–æ¨¡å¼ï¼‰"><a href="#Mode-2-â€”-balance-xorï¼ˆå¼‚æˆ–æ¨¡å¼ï¼‰" class="headerlink" title="Mode 2 â€” balance-xorï¼ˆå¼‚æˆ–æ¨¡å¼ï¼‰"></a>Mode 2 â€” balance-xorï¼ˆå¼‚æˆ–æ¨¡å¼ï¼‰</h2><p>åŸºäºæº MAC å’Œç›®çš„ MAC çš„ Hash é€‰æ‹©ç½‘å¡</p><h2 id="Mode-3-â€”-broadcastï¼ˆå¹¿æ’­æ¨¡å¼ï¼‰"><a href="#Mode-3-â€”-broadcastï¼ˆå¹¿æ’­æ¨¡å¼ï¼‰" class="headerlink" title="Mode 3 â€” broadcastï¼ˆå¹¿æ’­æ¨¡å¼ï¼‰"></a>Mode 3 â€” broadcastï¼ˆå¹¿æ’­æ¨¡å¼ï¼‰</h2><p>æ‰€æœ‰æ•°æ®åŒ…åœ¨æ‰€æœ‰ç½‘å¡ä¸Šä¼ è¾“ã€‚</p><h2 id="Mode-4-â€”-link-aggregationï¼ˆåŠ¨æ€é“¾æ¥èšåˆï¼‰"><a href="#Mode-4-â€”-link-aggregationï¼ˆåŠ¨æ€é“¾æ¥èšåˆï¼‰" class="headerlink" title="Mode 4 â€” link aggregationï¼ˆåŠ¨æ€é“¾æ¥èšåˆï¼‰"></a>Mode 4 â€” link aggregationï¼ˆåŠ¨æ€é“¾æ¥èšåˆï¼‰</h2><h2 id="Mode-5-â€”-balance-tlbï¼ˆä¼ è¾“è´Ÿè½½å‡è¡¡ï¼‰"><a href="#Mode-5-â€”-balance-tlbï¼ˆä¼ è¾“è´Ÿè½½å‡è¡¡ï¼‰" class="headerlink" title="Mode 5 â€” balance-tlbï¼ˆä¼ è¾“è´Ÿè½½å‡è¡¡ï¼‰"></a>Mode 5 â€” balance-tlbï¼ˆä¼ è¾“è´Ÿè½½å‡è¡¡ï¼‰</h2><h2 id="Mode-6-â€”-balance-albï¼ˆé€‚åº”æ€§è´Ÿè½½å‡è¡¡ï¼‰"><a href="#Mode-6-â€”-balance-albï¼ˆé€‚åº”æ€§è´Ÿè½½å‡è¡¡ï¼‰" class="headerlink" title="Mode 6 â€” balance-albï¼ˆé€‚åº”æ€§è´Ÿè½½å‡è¡¡ï¼‰"></a>Mode 6 â€” balance-albï¼ˆé€‚åº”æ€§è´Ÿè½½å‡è¡¡ï¼‰</h2><h1 id="ä½¿ç”¨-nmcli-ç»‘å®šç½‘å¡"><a href="#ä½¿ç”¨-nmcli-ç»‘å®šç½‘å¡" class="headerlink" title="ä½¿ç”¨ nmcli ç»‘å®šç½‘å¡"></a>ä½¿ç”¨ <code>nmcli</code> ç»‘å®šç½‘å¡</h1><h2 id="ç»‘å®šç½‘å¡"><a href="#ç»‘å®šç½‘å¡" class="headerlink" title="ç»‘å®šç½‘å¡"></a>ç»‘å®šç½‘å¡</h2><ol><li><p>åˆ›å»ºç»‘å®šç½‘å¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection add <span class="built_in">type</span> bond ifname &lt;ç»‘å®šç½‘å¡å&gt; mode &lt;æ¨¡å¼&gt;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€å¼ åä¸º <code>bond0</code> çš„ä¸»å¤‡æ¨¡å¼ç»‘å®šç½‘å¡</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2404:/<span class="comment"># nmcli connection add type bond ifname bond0 mode active-backup</span></span><br><span class="line">Connection <span class="string">'bond-bond0'</span> (fed29263<span class="literal">-5656</span><span class="literal">-449b</span><span class="literal">-95c8</span><span class="literal">-cf2e23432736</span>) successfully added.</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç½‘ç»œè®¾å¤‡ï¼Œå³å¯çœ‹åˆ°æ–°å»ºçš„ <code>bond0</code> ç½‘å¡</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2404:/<span class="comment"># nmcli device status</span></span><br><span class="line">DEVICE   TYPE      STATE                                  CONNECTION</span><br><span class="line">ens160   ethernet  connected                              netplan<span class="literal">-ens160</span></span><br><span class="line">ens256   ethernet  connected                              Wired connection <span class="number">1</span></span><br><span class="line">bond0    bond      connecting (getting IP configuration)  bond<span class="literal">-bond0</span></span><br><span class="line">lo       loopback  connected (externally)                 lo</span><br><span class="line">docker0  bridge    connected (externally)                 docker0</span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ ä»å±ç½‘å¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection add <span class="built_in">type</span> bond-slave ifname &lt;ä»å±ç½‘å¡å&gt; master &lt;ç»‘å®šç½‘å¡å&gt;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œå°† <code>ens160</code> å’Œ <code>ens256</code> ç½‘å¡ç»‘å®šåˆ° <code>bond0</code> ç½‘å¡ä¸Š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2404:/<span class="comment"># nmcli connection add type bond-slave ifname ens160 master bond0</span></span><br><span class="line">Connection <span class="string">'bond-slave-ens160'</span> (<span class="number">021</span>cce67<span class="literal">-1440</span><span class="literal">-4d50</span><span class="literal">-a8a9</span><span class="literal">-5c7faf8a361b</span>) successfully added.</span><br><span class="line">root@ubuntu2404:/<span class="comment"># nmcli connection add type bond-slave ifname ens256 master bond0</span></span><br><span class="line">Connection <span class="string">'bond-slave-ens256'</span> (f17d7bf7<span class="literal">-4313</span><span class="literal">-4f90</span><span class="literal">-8f9c</span><span class="literal">-5c35c0ebe319</span>) successfully added.</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2404:/<span class="comment"># nmcli connection show</span></span><br><span class="line">NAME                UUID                                  TYPE      DEVICE</span><br><span class="line">netplan<span class="literal">-ens160</span>      febc54dc<span class="literal">-e29c</span><span class="literal">-3939</span><span class="literal">-a911</span><span class="literal">-8a11855bd1c8</span>  ethernet  ens160</span><br><span class="line">Wired connection <span class="number">1</span>  ec18620e<span class="literal">-37bf</span><span class="literal">-3343</span><span class="literal">-acf5</span><span class="literal">-b57b8928465d</span>  ethernet  ens256</span><br><span class="line">bond<span class="literal">-bond0</span>          fed29263<span class="literal">-5656</span><span class="literal">-449b</span><span class="literal">-95c8</span><span class="literal">-cf2e23432736</span>  bond      bond0</span><br><span class="line">lo                  <span class="number">73</span>b7043c<span class="literal">-59f1</span><span class="literal">-42aa</span><span class="literal">-a711</span><span class="literal">-2eb721fc18b4</span>  loopback  lo</span><br><span class="line">docker0             <span class="number">5</span>fb2c927<span class="literal">-9b29</span><span class="literal">-4d43</span><span class="literal">-99ab</span><span class="literal">-09af694a8927</span>  bridge    docker0</span><br><span class="line">bond<span class="literal">-slave</span><span class="literal">-ens160</span>   <span class="number">021</span>cce67<span class="literal">-1440</span><span class="literal">-4d50</span><span class="literal">-a8a9</span><span class="literal">-5c7faf8a361b</span>  ethernet  --</span><br><span class="line">bond<span class="literal">-slave</span><span class="literal">-ens256</span>   f17d7bf7<span class="literal">-4313</span><span class="literal">-4f90</span><span class="literal">-8f9c</span><span class="literal">-5c35c0ebe319</span>  ethernet  --</span><br></pre></td></tr></table></figure></li><li><p>é…ç½®ç»‘å®šç½‘å¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection modify bond-bond0 ipv4.addresses 172.16.19.200&#x2F;24 ipv4.gateway 172.16.19.2 ipv4.method manual</span><br></pre></td></tr></table></figure></li><li><p>æ¿€æ´»ç»‘å®š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection up bond-bond0</span><br></pre></td></tr></table></figure></li><li><p>æ¿€æ´»ä»å±ç½‘å¡ï¼ˆå¯ä¸æ¿€æ´»ï¼Œæ¿€æ´»åä¼šå¯¼è‡´åŸæœ¬çš„ç½‘å¡æ— æ³•ç›´æ¥è®¿é—®ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection up bond-slave-ens160</span><br><span class="line">nmcli connection up bond-slave-ens256</span><br></pre></td></tr></table></figure></li></ol><h2 id="éªŒè¯ç½‘å¡å†—ä½™"><a href="#éªŒè¯ç½‘å¡å†—ä½™" class="headerlink" title="éªŒè¯ç½‘å¡å†—ä½™"></a>éªŒè¯ç½‘å¡å†—ä½™</h2><p>æŒ‰ç…§ä¸Šé¢æ­¥éª¤ç»‘å®šå®Œç½‘å¡åï¼Œå¯ä»¥çœ‹åˆ°å¤šäº†ä¸€å¼ ç½‘å¡ bond0</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2404:/<span class="comment"># ip a</span></span><br><span class="line"><span class="number">1</span>: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="number">1000</span></span><br><span class="line">    link/loopback <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> brd <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">    inet <span class="number">127.0</span>.<span class="number">0.1</span>/<span class="number">8</span> scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::<span class="number">1</span>/<span class="number">128</span> scope host noprefixroute</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="number">2</span>: ens160: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc pfifo_fast master bond0 state UP group default qlen <span class="number">1000</span></span><br><span class="line">    link/ether <span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:ec:<span class="number">41</span>:a3 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    altname enp2s0</span><br><span class="line"><span class="number">3</span>: ens256: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc pfifo_fast master bond0 state UP group default qlen <span class="number">1000</span></span><br><span class="line">    link/ether <span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:ec:<span class="number">41</span>:a3 brd ff:ff:ff:ff:ff:ff permaddr <span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:ec:<span class="number">41</span>:ad</span><br><span class="line">    altname enp26s0</span><br><span class="line"><span class="number">4</span>: docker0: &lt;NO<span class="literal">-CARRIER</span>,BROADCAST,MULTICAST,UP&gt; mtu <span class="number">1500</span> qdisc noqueue state DOWN group default</span><br><span class="line">    link/ether <span class="number">02</span>:<span class="number">42</span>:<span class="number">8</span>b:f0:<span class="number">0</span>f:<span class="number">5</span>a brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet <span class="number">172.17</span>.<span class="number">0.1</span>/<span class="number">16</span> brd <span class="number">172.17</span>.<span class="number">255.255</span> scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="number">9</span>: bond0: &lt;BROADCAST,MULTICAST,MASTER,UP,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc noqueue state UP group default qlen <span class="number">1000</span></span><br><span class="line">    link/ether <span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:ec:<span class="number">41</span>:a3 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet <span class="number">172.16</span>.<span class="number">19.200</span>/<span class="number">24</span> brd <span class="number">172.16</span>.<span class="number">19.255</span> scope global noprefixroute bond0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::<span class="number">6</span>d51:ebf5:<span class="number">7</span>acc:<span class="number">83</span>ff/<span class="number">64</span> scope link noprefixroute</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2404:/<span class="comment"># nmcli connection show</span></span><br><span class="line">NAME                UUID                                  TYPE      DEVICE</span><br><span class="line">bond<span class="literal">-bond0</span>          <span class="number">1</span>d93dc92<span class="literal">-b5b8</span><span class="literal">-4710</span><span class="literal">-9f67</span><span class="literal">-2424899947e3</span>  bond      bond0</span><br><span class="line">bond<span class="literal">-slave</span><span class="literal">-ens160</span>   f75880e7<span class="literal">-977e</span><span class="literal">-4537</span><span class="literal">-84cd</span><span class="literal">-a5bc802ad32c</span>  ethernet  ens160</span><br><span class="line">bond<span class="literal">-slave</span><span class="literal">-ens256</span>   cf9838da<span class="literal">-7c22</span><span class="literal">-4066</span><span class="literal">-ba2d</span><span class="literal">-2b89d3e08f63</span>  ethernet  ens256</span><br><span class="line">lo                  <span class="number">73</span>b7043c<span class="literal">-59f1</span><span class="literal">-42aa</span><span class="literal">-a711</span><span class="literal">-2eb721fc18b4</span>  loopback  lo</span><br><span class="line">docker0             <span class="number">5</span>fb2c927<span class="literal">-9b29</span><span class="literal">-4d43</span><span class="literal">-99ab</span><span class="literal">-09af694a8927</span>  bridge    docker0</span><br><span class="line">netplan<span class="literal">-ens160</span>      febc54dc<span class="literal">-e29c</span><span class="literal">-3939</span><span class="literal">-a911</span><span class="literal">-8a11855bd1c8</span>  ethernet  --</span><br><span class="line">Wired connection <span class="number">1</span>  ec18620e<span class="literal">-37bf</span><span class="literal">-3343</span><span class="literal">-acf5</span><span class="literal">-b57b8928465d</span>  ethernet  --</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2404:/<span class="comment"># nmcli device status</span></span><br><span class="line">DEVICE   TYPE      STATE                   CONNECTION</span><br><span class="line">bond0    bond      connected               bond<span class="literal">-bond0</span></span><br><span class="line">ens160   ethernet  connected               bond<span class="literal">-slave</span><span class="literal">-ens160</span></span><br><span class="line">ens256   ethernet  connected               bond<span class="literal">-slave</span><span class="literal">-ens256</span></span><br><span class="line">lo       loopback  connected (externally)  lo</span><br><span class="line">docker0  bridge    connected (externally)  docker0</span><br></pre></td></tr></table></figure><p>é€šè¿‡ bond0 ç½‘å¡ IP è¿æ¥ï¼Œå•ç‹¬å…³æ‰ ens160 æˆ–è€… ens256 ç½‘å¡ï¼ˆ<code>ifconfig ens160 down</code>ï¼‰ï¼Œè¿æ¥éƒ½ä¸ä¼šæ”¶åˆ°å½±å“ã€‚</p><ol><li><p>æ¢å¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection down bond-bond0</span><br><span class="line">nmcli connection down bond-slave-ens160</span><br><span class="line">nmcli connection down bond-slave-ens256</span><br><span class="line"></span><br><span class="line">nmcli connection del bond-bond0</span><br><span class="line">nmcli connection del bond-slave-ens160</span><br><span class="line">nmcli connection del bond-slave-ens256</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;Linux NIC Bonding æŠ€æœ¯å¯ä»¥å°†å¤šå¼ ç‰©ç†ç½‘å¡æˆ–è€…è™šæ‹Ÿç½‘å¡ç»‘å®šä¸ºä¸€å¼ è™šæ‹Ÿçš„é€»è¾‘ç½‘å¡ï¼Œä»è€Œå®ç°ç½‘å¡çš„å†—ä½™ã€å¸¦å®½çš„æ‰©å®¹ä»¥åŠè´Ÿè½½å‡è¡¡ã€‚&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>Linuxç­–ç•¥è·¯ç”±</title>
    <link href="https://gy23333.github.io/2025/03/20/Linux%E7%AD%96%E7%95%A5%E8%B7%AF%E7%94%B1/"/>
    <id>https://gy23333.github.io/2025/03/20/Linux%E7%AD%96%E7%95%A5%E8%B7%AF%E7%94%B1/</id>
    <published>2025-03-20T15:11:01.000Z</published>
    <updated>2025-03-23T16:38:45.429Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>Linux ç­–ç•¥è·¯ç”±æ˜¯ä¸€ç§é«˜çº§è·¯ç”±æœºåˆ¶ã€‚ç›¸æ¯”äºä¼ ç»Ÿè·¯ç”±ï¼Œç­–ç•¥è·¯ç”±å…è®¸ç”¨æˆ·é…ç½®å¤šå¼ è·¯ç”±è¡¨ï¼Œæ ¹æ®æºåœ°å€ã€ç›®çš„åœ°å€ç­‰é€‰æ‹©ä¸åŒè·¯ç”±è¡¨ï¼Œæä¾›äº†æ›´çµæ´»çš„è·¯ç”±æ§åˆ¶èƒ½åŠ›ã€‚</p><a id="more"></a><h1 id="è·¯ç”±è¡¨ï¼ˆRouting-Tableï¼‰"><a href="#è·¯ç”±è¡¨ï¼ˆRouting-Tableï¼‰" class="headerlink" title="è·¯ç”±è¡¨ï¼ˆRouting Tableï¼‰"></a>è·¯ç”±è¡¨ï¼ˆRouting Tableï¼‰</h1><p>è·¯ç”±è¡¨æ˜¯å­˜å‚¨è·¯ç”±è§„åˆ™çš„é›†åˆï¼ŒLinux æ”¯æŒé…ç½®å¤šå¼ è·¯ç”±è¡¨ã€‚</p><h2 id="rt-tables-æ–‡ä»¶"><a href="#rt-tables-æ–‡ä»¶" class="headerlink" title="rt_tables æ–‡ä»¶"></a>rt_tables æ–‡ä»¶</h2><p><code>/etc/iproute2/rt_tables</code> æ˜¯ Linux ä¸­ç”¨äºå®šä¹‰è·¯ç”±è¡¨åç§°å’Œç¼–å·æ˜ å°„çš„æ–‡ä»¶ã€‚</p><p>å…¶ä¸­çš„æ¯ä¸€è¡Œå®šä¹‰äº†ä¸€ä¸ªè·¯ç”±è¡¨ï¼ŒåŒ…æ‹¬å…¶ç¼–å·ï¼ˆ1ï½255ï¼‰å’Œåç§°ï¼Œç¼–å·å’Œåç§°éƒ½ä¸èƒ½é‡å¤ã€‚</p><p>Linux å‘è¡Œç‰ˆä¸­ï¼Œ<code>/etc/iproute2/rt_tables</code> çš„é»˜è®¤å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2404:/<span class="comment"># cat /etc/iproute2/rt_tables</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># reserved values</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="number">255</span>     local</span><br><span class="line"><span class="number">254</span>     main</span><br><span class="line"><span class="number">253</span>     default</span><br><span class="line"><span class="number">0</span>       unspec</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># local</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#1      inr.ruhep</span></span><br></pre></td></tr></table></figure><h2 id="Linux-é»˜è®¤è·¯ç”±è¡¨"><a href="#Linux-é»˜è®¤è·¯ç”±è¡¨" class="headerlink" title="Linux é»˜è®¤è·¯ç”±è¡¨"></a>Linux é»˜è®¤è·¯ç”±è¡¨</h2><p>Linux åˆå§‹çš„é»˜è®¤çŠ¶æ€ä¸‹ï¼ŒåŒ…å«ä¸‹é¢å››ä¸ªè·¯ç”±è¡¨ï¼š</p><ul><li><p><code>local</code>è¡¨</p><ul><li>ç¼–å·ï¼š255</li><li>å­˜å‚¨æœ¬åœ°æ¥å£åœ°å€å’Œå¹¿æ’­åœ°å€</li><li>å†…æ ¸è‡ªåŠ¨ç»´æŠ¤ï¼Œç”¨æˆ·é€šå¸¸ä¸éœ€è¦ä¿®æ”¹</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2404:/<span class="comment"># ip route show table local</span></span><br><span class="line">local <span class="number">127.0</span>.<span class="number">0.0</span>/<span class="number">8</span> dev lo proto kernel scope host src <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">local <span class="number">127.0</span>.<span class="number">0.1</span> dev lo proto kernel scope host src <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">broadcast <span class="number">127.255</span>.<span class="number">255.255</span> dev lo proto kernel scope link src <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">local <span class="number">172.16</span>.<span class="number">19.129</span> dev ens160 proto kernel scope host src <span class="number">172.16</span>.<span class="number">19.129</span></span><br><span class="line">local <span class="number">172.16</span>.<span class="number">19.133</span> dev ens256 proto kernel scope host src <span class="number">172.16</span>.<span class="number">19.133</span></span><br><span class="line">broadcast <span class="number">172.16</span>.<span class="number">19.255</span> dev ens160 proto kernel scope link src <span class="number">172.16</span>.<span class="number">19.129</span></span><br><span class="line">broadcast <span class="number">172.16</span>.<span class="number">19.255</span> dev ens256 proto kernel scope link src <span class="number">172.16</span>.<span class="number">19.133</span></span><br><span class="line">local <span class="number">172.17</span>.<span class="number">0.1</span> dev docker0 proto kernel scope host src <span class="number">172.17</span>.<span class="number">0.1</span></span><br><span class="line">broadcast <span class="number">172.17</span>.<span class="number">255.255</span> dev docker0 proto kernel scope link src <span class="number">172.17</span>.<span class="number">0.1</span> linkdown</span><br></pre></td></tr></table></figure></li><li><p><code>main</code>è¡¨</p><ul><li>ç¼–å·ï¼š254</li><li>ä¸»è·¯ç”±è¡¨ï¼Œä¼ ç»Ÿè·¯ç”±ä½¿ç”¨çš„è¡¨</li><li>é€šè¿‡ <code>ip route</code> å‘½ä»¤é…ç½®æˆ–å±•ç¤ºçš„éƒ½æ˜¯æ­¤è¡¨</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2404:/<span class="comment"># ip route show table main</span></span><br><span class="line">default via <span class="number">172.16</span>.<span class="number">19.2</span> dev ens160 proto dhcp src <span class="number">172.16</span>.<span class="number">19.129</span> metric <span class="number">100</span></span><br><span class="line">default via <span class="number">172.16</span>.<span class="number">19.2</span> dev ens256 proto dhcp src <span class="number">172.16</span>.<span class="number">19.133</span> metric <span class="number">101</span></span><br><span class="line"><span class="number">172.16</span>.<span class="number">19.0</span>/<span class="number">24</span> dev ens160 proto kernel scope link src <span class="number">172.16</span>.<span class="number">19.129</span> metric <span class="number">100</span></span><br><span class="line"><span class="number">172.16</span>.<span class="number">19.0</span>/<span class="number">24</span> dev ens256 proto kernel scope link src <span class="number">172.16</span>.<span class="number">19.133</span> metric <span class="number">101</span></span><br><span class="line"><span class="number">172.17</span>.<span class="number">0.0</span>/<span class="number">16</span> dev docker0 proto kernel scope link src <span class="number">172.17</span>.<span class="number">0.1</span> linkdown</span><br></pre></td></tr></table></figure></li><li><p><code>default</code>è¡¨</p><ul><li>ç¼–å·ï¼š253</li><li>é»˜è®¤è·¯ç”±è¡¨ï¼Œé€šå¸¸ç”¨äºå­˜å‚¨é»˜è®¤è·¯ç”±</li><li>åˆå§‹æ—¶ä¸ºç©º</li></ul></li><li><p><code>unspec</code>è¡¨</p><ul><li>ç¼–å·ï¼š0</li><li>æœªæŒ‡å®šè·¯ç”±è¡¨ï¼Œç”¨äºè¡¨ç¤ºæœªæŒ‡å®šæˆ–æ— æ•ˆçš„è·¯ç”±è¡¨</li></ul></li></ul><h2 id="è‡ªå®šä¹‰è·¯ç”±è¡¨"><a href="#è‡ªå®šä¹‰è·¯ç”±è¡¨" class="headerlink" title="è‡ªå®šä¹‰è·¯ç”±è¡¨"></a>è‡ªå®šä¹‰è·¯ç”±è¡¨</h2><p>ä¿®æ”¹ <code>/etc/iproute2/rt_tables</code> æ–‡ä»¶ï¼Œå¯æ·»åŠ è‡ªå®šä¹‰è·¯ç”±è¡¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;ç¼–å·&gt;&lt;è·¯ç”±è¡¨å&gt;</span><br></pre></td></tr></table></figure><p>å»ºè®®ï¼šç¼–å·è™½ç„¶å¯ä»¥ä» 1 å¼€å§‹å–ï¼Œä½†æ˜¯ä¸ºäº†é¿å…ä¸æœªæ¥ç³»ç»Ÿå¯èƒ½ä¿ç•™çš„ç¼–å·å†²çªï¼Œé€šå¸¸é€‰æ‹©ä» 100 å¼€å§‹åˆ†é…ç¼–å·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">100   custom1</span><br><span class="line">101   custom2</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åˆ†æ®µåˆ†é…ç¼–å·ï¼Œä»¥æ–¹ä¾¿ç®¡ç†ä¸åŒç±»å‹çš„è·¯ç”±è¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">100   custom1</span><br><span class="line">200   custom2</span><br></pre></td></tr></table></figure><h1 id="è·¯ç”±è§„åˆ™ï¼ˆRuleï¼‰"><a href="#è·¯ç”±è§„åˆ™ï¼ˆRuleï¼‰" class="headerlink" title="è·¯ç”±è§„åˆ™ï¼ˆRuleï¼‰"></a>è·¯ç”±è§„åˆ™ï¼ˆRuleï¼‰</h1><p>è·¯ç”±è§„åˆ™ï¼šæ•°æ®åŒ…å¦‚ä½•åŒ¹é…å¹¶é€‰æ‹©è·¯ç”±è¡¨çš„è§„åˆ™ï¼Œæ ¹æ®ç‰¹å®šçš„æ¡ä»¶ï¼ˆå¦‚æºåœ°å€ã€ç›®çš„åœ°å€ã€å…¥æ¥å£ç­‰ï¼‰é€‰æ‹©ä¸åŒçš„è·¯ç”±è¡¨ã€‚</p><h2 id="æŸ¥çœ‹è·¯ç”±è§„åˆ™"><a href="#æŸ¥çœ‹è·¯ç”±è§„åˆ™" class="headerlink" title="æŸ¥çœ‹è·¯ç”±è§„åˆ™"></a>æŸ¥çœ‹è·¯ç”±è§„åˆ™</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2404:/<span class="comment"># ip rule show</span></span><br><span class="line"><span class="number">0</span>:      from all lookup local</span><br><span class="line"><span class="number">32766</span>:  from all lookup main</span><br><span class="line"><span class="number">32767</span>:  from all lookup default</span><br></pre></td></tr></table></figure><h2 id="è·¯ç”±è§„åˆ™çš„ç»„æˆ"><a href="#è·¯ç”±è§„åˆ™çš„ç»„æˆ" class="headerlink" title="è·¯ç”±è§„åˆ™çš„ç»„æˆ"></a>è·¯ç”±è§„åˆ™çš„ç»„æˆ</h2><p>æ¯ä¸€æ¡è·¯ç”±è§„åˆ™åŒ…å« 3 ä¸ªä¿¡æ¯ï¼š</p><ul><li>ä¼˜å…ˆçº§ï¼šæ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚è‡ªå®šä¹‰è§„åˆ™çš„ä¼˜å…ˆçº§é€šå¸¸è®¾ç½®åœ¨ <strong>1 åˆ° 32765</strong> ä¹‹é—´ã€‚</li><li>æ¡ä»¶ï¼šåŒ¹é…æ•°æ®åŒ…çš„æ¡ä»¶ï¼Œå¦‚æºåœ°å€ã€ç›®çš„åœ°å€ã€å…¥æ¥å£ç­‰</li><li>åŠ¨ä½œï¼šé€šå¸¸è§„å®šé€‰æ‹©å“ªä¸ªè·¯ç”±è¡¨</li></ul><p>æŒ‰ç…§ä¼˜å…ˆçº§ï¼Œä»å°åˆ°å¤§åŒ¹é…è§„åˆ™ï¼Œå¦‚æœåŒ¹é…åˆ°ï¼Œåˆ™é€‰æ‹©è§„å®šçš„è·¯ç”±è¡¨ã€‚</p><h2 id="å¢-åˆ è·¯ç”±è§„åˆ™"><a href="#å¢-åˆ è·¯ç”±è§„åˆ™" class="headerlink" title="å¢/åˆ è·¯ç”±è§„åˆ™"></a>å¢/åˆ è·¯ç”±è§„åˆ™</h2><ul><li><p>å¢åŠ è·¯ç”±è§„åˆ™ï¼ˆä¼˜å…ˆçº§å¯ç¼ºçœï¼Œç¼ºçœæ—¶å–ä½ä¼˜å…ˆçº§ï¼‰</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip rule add &lt;æ¡ä»¶&gt; lookup &lt;è¡¨å&gt; priority &lt;ä¼˜å…ˆçº§&gt;</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤è·¯ç”±è§„åˆ™</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip rule del &lt;æ¡ä»¶&gt; lookup &lt;è¡¨å&gt;</span><br></pre></td></tr></table></figure></li></ul><h2 id="åŒ¹é…æ¡ä»¶"><a href="#åŒ¹é…æ¡ä»¶" class="headerlink" title="åŒ¹é…æ¡ä»¶"></a>åŒ¹é…æ¡ä»¶</h2><p>è·¯ç”±è§„åˆ™çš„åŒ¹é…æ¡ä»¶æ”¯æŒä»¥ä¸‹å­—æ®µï¼š</p><ul><li><p>åŒ¹é…æ•°æ®åŒ…çš„æºåœ°å€</p><ul><li><p><code>from &lt;PREFIX&gt;</code></p></li><li><p>ç¤ºä¾‹ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¥è‡ª 192.168.1.0/24 çš„æµé‡ä½¿ç”¨ custom1 è¡¨</span></span><br><span class="line">ip rule add from <span class="number">192.168</span>.<span class="number">1.0</span>/<span class="number">24</span> lookup custom1</span><br></pre></td></tr></table></figure></li></ul></li><li><p>åŒ¹é…æ•°æ®åŒ…çš„ç›®çš„åœ°å€</p><ul><li><p><code>to &lt;PREFIX&gt;</code></p></li><li><p>ç¤ºä¾‹ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å»å¾€ 8.8.8.8 çš„æµé‡ä½¿ç”¨ custom2 è¡¨</span></span><br><span class="line">ip rule add to <span class="number">8.8</span>.<span class="number">8.8</span> lookup custom2</span><br></pre></td></tr></table></figure></li></ul></li><li><p>åŒ¹é…æ•°æ®åŒ…çš„å…¥ç½‘å¡</p><ul><li><p><code>iif &lt;ç½‘å¡&gt;</code></p></li><li><p>ç¤ºä¾‹ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä» eth1 æ¥å£è¿›å…¥çš„æµé‡ä½¿ç”¨ custom3 è¡¨</span></span><br><span class="line">ip rule add iif eth1 lookup custom3</span><br></pre></td></tr></table></figure></li></ul></li><li><p>åŒ¹é…æ•°æ®åŒ…çš„åè®®</p><ul><li><p><code>ipproto &lt;PROTOCOL&gt;</code></p></li><li><p>ç¤ºä¾‹ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TCP åè®®çš„æµé‡ä½¿ç”¨ custom4 è¡¨</span></span><br><span class="line">ip rule add proto tcp lookup custom4</span><br></pre></td></tr></table></figure></li></ul></li><li><p>ç­‰ç­‰ï¼Œè¯¦ç»†è§ help</p></li></ul><h2 id="help"><a href="#help" class="headerlink" title="help"></a>help</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2404:/<span class="comment"># ip rule help</span></span><br><span class="line">Usage: ip rule &#123; add | del &#125; SELECTOR ACTION</span><br><span class="line">       ip rule &#123; flush | save | restore &#125;</span><br><span class="line">       ip rule [ <span class="type">list</span> [ <span class="type">SELECTOR</span> ]]</span><br><span class="line">SELECTOR := [ <span class="type">not</span> ] [ <span class="type">from</span> <span class="type">PREFIX</span> ] [ <span class="type">to</span> <span class="type">PREFIX</span> ] [ <span class="type">tos</span> <span class="type">TOS</span> ]</span><br><span class="line">            [ <span class="type">fwmark</span> <span class="type">FWMARK</span>[/<span class="type">MASK</span>] ]</span><br><span class="line">            [ <span class="type">iif</span> <span class="built_in">STRING</span> ] [ <span class="type">oif</span> <span class="built_in">STRING</span> ] [ <span class="type">pref</span> <span class="type">NUMBER</span> ] [ <span class="type">l3mdev</span> ]</span><br><span class="line">            [ <span class="type">uidrange</span> <span class="type">NUMBER</span>-<span class="type">NUMBER</span> ]</span><br><span class="line">            [ <span class="type">ipproto</span> <span class="type">PROTOCOL</span> ]</span><br><span class="line">            [ <span class="type">sport</span> [ <span class="type">NUMBER</span> | <span class="type">NUMBER</span>-<span class="type">NUMBER</span> ]</span><br><span class="line">            [ <span class="type">dport</span> [ <span class="type">NUMBER</span> | <span class="type">NUMBER</span>-<span class="type">NUMBER</span> ] ]</span><br><span class="line"><span class="type">ACTION</span> := [ <span class="type">table</span> <span class="type">TABLE_ID</span> ]</span><br><span class="line">          [ <span class="type">protocol</span> <span class="type">PROTO</span> ]</span><br><span class="line">          [ <span class="type">nat</span> <span class="type">ADDRESS</span> ]</span><br><span class="line">          [ <span class="type">realms</span> [<span class="type">SRCREALM</span>/]<span class="type">DSTREALM</span> ]</span><br><span class="line">          [ <span class="type">goto</span> <span class="type">NUMBER</span> ]</span><br><span class="line">          <span class="type">SUPPRESSOR</span></span><br><span class="line"><span class="type">SUPPRESSOR</span> := [ <span class="type">suppress_prefixlength</span> <span class="type">NUMBER</span> ]</span><br><span class="line">              [ <span class="type">suppress_ifgroup</span> <span class="type">DEVGROUP</span> ]</span><br><span class="line"><span class="type">TABLE_ID</span> := [ <span class="type">local</span> | <span class="type">main</span> | <span class="type">default</span> | <span class="type">NUMBER</span> ]</span><br></pre></td></tr></table></figure><h1 id="è·¯ç”±ï¼ˆRouteï¼‰"><a href="#è·¯ç”±ï¼ˆRouteï¼‰" class="headerlink" title="è·¯ç”±ï¼ˆRouteï¼‰"></a>è·¯ç”±ï¼ˆRouteï¼‰</h1><p>æ¯å¼ è·¯ç”±è¡¨é‡Œéƒ½å¯ä»¥é…ç½®è‡ªå·±çš„è·¯ç”±ã€‚</p><h2 id="ip-route-å‘½ä»¤"><a href="#ip-route-å‘½ä»¤" class="headerlink" title="ip route å‘½ä»¤"></a><code>ip route</code> å‘½ä»¤</h2><p><code>ip route</code> å‘½ä»¤å¦‚æœæ²¡æœ‰æŒ‡å®šè·¯ç”±è¡¨ï¼Œåˆ™é»˜è®¤æŒ‡å®š <code>main</code> è¡¨ã€‚</p><h3 id="æŸ¥çœ‹è·¯ç”±è¡¨"><a href="#æŸ¥çœ‹è·¯ç”±è¡¨" class="headerlink" title="æŸ¥çœ‹è·¯ç”±è¡¨"></a>æŸ¥çœ‹è·¯ç”±è¡¨</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip route show table &lt;è·¯ç”±è¡¨å&gt;</span><br></pre></td></tr></table></figure><h2 id="help-1"><a href="#help-1" class="headerlink" title="help"></a>help</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2404:/<span class="comment"># ip route help</span></span><br><span class="line">Usage: ip route &#123; list | flush &#125; SELECTOR</span><br><span class="line">       ip route save SELECTOR</span><br><span class="line">       ip route restore</span><br><span class="line">       ip route showdump</span><br><span class="line">       ip route get [ <span class="type">ROUTE_GET_FLAGS</span> ] ADDRESS</span><br><span class="line">                            [ <span class="type">from</span> <span class="type">ADDRESS</span> <span class="type">iif</span> <span class="built_in">STRING</span> ]</span><br><span class="line">                            [ <span class="type">oif</span> <span class="built_in">STRING</span> ] [ <span class="type">tos</span> <span class="type">TOS</span> ]</span><br><span class="line">                            [ <span class="type">mark</span> <span class="type">NUMBER</span> ] [ <span class="type">vrf</span> <span class="type">NAME</span> ]</span><br><span class="line">                            [ <span class="type">uid</span> <span class="type">NUMBER</span> ] [ <span class="type">ipproto</span> <span class="type">PROTOCOL</span> ]</span><br><span class="line">                            [ <span class="type">sport</span> <span class="type">NUMBER</span> ] [ <span class="type">dport</span> <span class="type">NUMBER</span> ]</span><br><span class="line">       ip route &#123; add | del | change | append | replace &#125; ROUTE</span><br><span class="line">SELECTOR := [ <span class="type">root</span> <span class="type">PREFIX</span> ] [ <span class="type">match</span> <span class="type">PREFIX</span> ] [ <span class="type">exact</span> <span class="type">PREFIX</span> ]</span><br><span class="line">            [ <span class="type">table</span> <span class="type">TABLE_ID</span> ] [ <span class="type">vrf</span> <span class="type">NAME</span> ] [ <span class="type">proto</span> <span class="type">RTPROTO</span> ]</span><br><span class="line">            [ <span class="type">type</span> <span class="type">TYPE</span> ] [ <span class="type">scope</span> <span class="type">SCOPE</span> ]</span><br><span class="line">ROUTE := NODE_SPEC [ <span class="type">INFO_SPEC</span> ]</span><br><span class="line">NODE_SPEC := [ <span class="type">TYPE</span> ] PREFIX [ <span class="type">tos</span> <span class="type">TOS</span> ]</span><br><span class="line">             [ <span class="type">table</span> <span class="type">TABLE_ID</span> ] [ <span class="type">proto</span> <span class="type">RTPROTO</span> ]</span><br><span class="line">             [ <span class="type">scope</span> <span class="type">SCOPE</span> ] [ <span class="type">metric</span> <span class="type">METRIC</span> ]</span><br><span class="line">             [ <span class="type">ttl</span>-<span class="type">propagate</span> &#123; <span class="type">enabled</span> | <span class="type">disabled</span> &#125; ]</span><br><span class="line">INFO_SPEC := &#123; NH | nhid ID &#125; OPTIONS FLAGS [ <span class="type">nexthop</span> <span class="type">NH</span> ]...</span><br><span class="line">NH := [ <span class="type">encap</span> <span class="type">ENCAPTYPE</span> <span class="type">ENCAPHDR</span> ] [ <span class="type">via</span> [ <span class="type">FAMILY</span> ] <span class="type">ADDRESS</span> ]</span><br><span class="line">      [ <span class="type">dev</span> <span class="built_in">STRING</span> ] [ <span class="type">weight</span> <span class="type">NUMBER</span> ] NHFLAGS</span><br><span class="line">FAMILY := [ <span class="type">inet</span> | <span class="type">inet6</span> | <span class="type">mpls</span> | <span class="type">bridge</span> | <span class="type">link</span> ]</span><br><span class="line">OPTIONS := FLAGS [ <span class="type">mtu</span> <span class="type">NUMBER</span> ] [ <span class="type">advmss</span> <span class="type">NUMBER</span> ] [ <span class="type">as</span> [ <span class="type">to</span> ] <span class="type">ADDRESS</span> ]</span><br><span class="line">           [ <span class="type">rtt</span> <span class="type">TIME</span> ] [ <span class="type">rttvar</span> <span class="type">TIME</span> ] [ <span class="type">reordering</span> <span class="type">NUMBER</span> ]</span><br><span class="line">           [ <span class="type">window</span> <span class="type">NUMBER</span> ] [ <span class="type">cwnd</span> <span class="type">NUMBER</span> ] [ <span class="type">initcwnd</span> <span class="type">NUMBER</span> ]</span><br><span class="line">           [ <span class="type">ssthresh</span> <span class="type">NUMBER</span> ] [ <span class="type">realms</span> <span class="type">REALM</span> ] [ <span class="type">src</span> <span class="type">ADDRESS</span> ]</span><br><span class="line">           [ <span class="type">rto_min</span> <span class="type">TIME</span> ] [ <span class="type">hoplimit</span> <span class="type">NUMBER</span> ] [ <span class="type">initrwnd</span> <span class="type">NUMBER</span> ]</span><br><span class="line">           [ <span class="type">features</span> <span class="type">FEATURES</span> ] [ <span class="type">quickack</span> <span class="built_in">BOOL</span> ] [ <span class="type">congctl</span> <span class="type">NAME</span> ]</span><br><span class="line">           [ <span class="type">pref</span> <span class="type">PREF</span> ] [ <span class="type">expires</span> <span class="type">TIME</span> ] [ <span class="type">fastopen_no_cookie</span> <span class="built_in">BOOL</span> ]</span><br><span class="line">TYPE := &#123; unicast | local | broadcast | multicast | <span class="keyword">throw</span> |</span><br><span class="line">          unreachable | prohibit | blackhole | nat &#125;</span><br><span class="line">TABLE_ID := [ <span class="type">local</span> | <span class="type">main</span> | <span class="type">default</span> | <span class="type">all</span> | <span class="type">NUMBER</span> ]</span><br><span class="line">SCOPE := [ <span class="type">host</span> | <span class="type">link</span> | <span class="type">global</span> | <span class="type">NUMBER</span> ]</span><br><span class="line">NHFLAGS := [ <span class="type">onlink</span> | <span class="type">pervasive</span> ]</span><br><span class="line">RTPROTO := [ <span class="type">kernel</span> | <span class="type">boot</span> | <span class="type">static</span> | <span class="type">NUMBER</span> ]</span><br><span class="line">PREF := [ <span class="type">low</span> | <span class="type">medium</span> | <span class="type">high</span> ]</span><br><span class="line">TIME := NUMBER[<span class="type">s</span>|<span class="type">ms</span>]</span><br><span class="line">BOOL := [<span class="number">1</span>|<span class="number">0</span>]</span><br><span class="line">FEATURES := ecn</span><br><span class="line">ENCAPTYPE := [ <span class="type">mpls</span> | <span class="type">ip</span> | <span class="type">ip6</span> | <span class="type">seg6</span> | <span class="type">seg6local</span> | <span class="type">rpl</span> | <span class="type">ioam6</span> | <span class="type">xfrm</span> ]</span><br><span class="line">ENCAPHDR := [ <span class="type">MPLSLABEL</span> | <span class="type">SEG6HDR</span> | <span class="type">SEG6LOCAL</span> | <span class="type">IOAM6HDR</span> | <span class="type">XFRMINFO</span> ]</span><br><span class="line">SEG6HDR := [ <span class="type">mode</span> <span class="type">SEGMODE</span> ] segs ADDR1,ADDRi,ADDRn [<span class="type">hmac</span> <span class="type">HMACKEYID</span>] [<span class="type">cleanup</span>]</span><br><span class="line">SEGMODE := [ <span class="type">encap</span> | <span class="type">encap.red</span> | <span class="type">inline</span> | <span class="type">l2encap</span> | <span class="type">l2encap.red</span> ]</span><br><span class="line">SEG6LOCAL := action ACTION [ <span class="type">OPTIONS</span> ] [ <span class="type">count</span> ]</span><br><span class="line">ACTION := &#123; <span class="keyword">End</span> | End.X | End.T | End.DX2 | End.DX6 | End.DX4 |</span><br><span class="line">            End.DT6 | End.DT4 | End.DT46 | End.B6 | End.B6.Encaps |</span><br><span class="line">            End.BM | End.S | End.AS | End.AM | End.BPF &#125;</span><br><span class="line">OPTIONS := OPTION [ <span class="type">OPTIONS</span> ]</span><br><span class="line">OPTION := &#123; flavors FLAVORS | srh SEG6HDR | nh4 ADDR | nh6 ADDR | iif DEV | oif DEV |</span><br><span class="line">            table TABLEID | vrftable TABLEID | endpoint PROGNAME &#125;</span><br><span class="line">FLAVORS := &#123; FLAVOR[,<span class="type">FLAVOR</span>] &#125;</span><br><span class="line">FLAVOR := &#123; psp | usp | usd | next<span class="literal">-csid</span> &#125;</span><br><span class="line">IOAM6HDR := trace prealloc type IOAM6_TRACE_TYPE ns IOAM6_NAMESPACE size IOAM6_TRACE_SIZE</span><br><span class="line">XFRMINFO := if_id IF_ID [ <span class="type">link_dev</span> <span class="type">LINK</span> ]</span><br><span class="line">ROUTE_GET_FLAGS := [ <span class="type">fibmatch</span> ]</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;Linux ç­–ç•¥è·¯ç”±æ˜¯ä¸€ç§é«˜çº§è·¯ç”±æœºåˆ¶ã€‚ç›¸æ¯”äºä¼ ç»Ÿè·¯ç”±ï¼Œç­–ç•¥è·¯ç”±å…è®¸ç”¨æˆ·é…ç½®å¤šå¼ è·¯ç”±è¡¨ï¼Œæ ¹æ®æºåœ°å€ã€ç›®çš„åœ°å€ç­‰é€‰æ‹©ä¸åŒè·¯ç”±è¡¨ï¼Œæä¾›äº†æ›´çµæ´»çš„è·¯ç”±æ§åˆ¶èƒ½åŠ›ã€‚&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>å †</title>
    <link href="https://gy23333.github.io/2025/01/16/%E5%A0%86/"/>
    <id>https://gy23333.github.io/2025/01/16/%E5%A0%86/</id>
    <published>2025-01-15T17:41:45.000Z</published>
    <updated>2025-01-19T16:48:44.084Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>å †ï¼ˆheapï¼‰æ˜¯ä¸€ç§æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„å®Œå…¨äºŒå‰æ ‘ï¼Œåˆ†ä¸ºå¤§é¡¶å †å’Œå°é¡¶å †ï¼Œé€šå¸¸ç”¨äºå®ç°ä¼˜å…ˆé˜Ÿåˆ—ï¼Œè¿›è¡Œå †æ’åºã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»æ¨æ•°æ®ç»“æ„ä»¥åŠå…¶ Go å®ç°ã€‚</p><a id="more"></a><h1 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h1><p>å †æ˜¯ä¸€ç§å®Œå…¨äºŒå‰æ ‘ï¼Œä¸ä¼˜å…ˆé˜Ÿåˆ—ç­‰ä»·ï¼Œåˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š</p><ul><li>å°é¡¶å †ï¼ˆmin heapï¼‰ï¼šä»»æ„èŠ‚ç‚¹çš„å€¼ &lt;= å…¶å­èŠ‚ç‚¹çš„å€¼</li><li>å¤§é¡¶å †ï¼ˆmax heapï¼‰ï¼šä»»æ„èŠ‚ç‚¹çš„å€¼ &gt;= å…¶å­èŠ‚ç‚¹çš„å€¼</li></ul><p><img src="https://gy-pic.oss-cn-hangzhou.aliyuncs.com/heap.png" alt="heap" style="zoom: 50%;" /></p><p>ä»å­˜å‚¨ç»“æ„æ¥çœ‹ï¼Œå®é™…å°±æ˜¯æ ‘å±‚æ¬¡éå†æ‰€å¾—çš„é˜Ÿåˆ—ã€‚</p><p><img src="https://gy-pic.oss-cn-hangzhou.aliyuncs.com/image-20250117014014174.png" alt="image-20250117014014174" style="zoom:50%;" /></p><h1 id="container-heap"><a href="#container-heap" class="headerlink" title="container/heap"></a><code>container/heap</code></h1><p>Golang æ ‡å‡†åº“ <code>container/heap</code> æä¾›äº†å †çš„å¿«é€Ÿå®ç°ã€‚</p><h2 id="æ¥å£å®šä¹‰æºç "><a href="#æ¥å£å®šä¹‰æºç " class="headerlink" title="æ¥å£å®šä¹‰æºç "></a>æ¥å£å®šä¹‰æºç </h2><p><code>heap.Interface</code> æ¥å£å®šä¹‰æºç </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Interface <span class="keyword">interface</span> &#123;</span><br><span class="line">sort.Interface</span><br><span class="line">Push(x any) <span class="comment">// add x as element Len()</span></span><br><span class="line">Pop() any   <span class="comment">// remove and return element Len() - 1.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>sort.Interface</code> æ¥å£å®šä¹‰æºç </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Interface <span class="keyword">interface</span> &#123;</span><br><span class="line"><span class="comment">// Len is the number of elements in the collection.</span></span><br><span class="line">Len() <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Less reports whether the element with index i</span></span><br><span class="line"><span class="comment">// must sort before the element with index j.</span></span><br><span class="line">Less(i, j <span class="keyword">int</span>) <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Swap swaps the elements with indexes i and j.</span></span><br><span class="line">Swap(i, j <span class="keyword">int</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¥å£å®ç°"><a href="#æ¥å£å®ç°" class="headerlink" title="æ¥å£å®ç°"></a>æ¥å£å®ç°</h2><p>é€šè¿‡å®ç° <code>heap.Interface</code> æ¥å£ï¼Œä»è€Œå®ç°ä¸€ä¸ªå †ã€‚</p><h3 id="å †çš„ç»“æ„ä½“"><a href="#å †çš„ç»“æ„ä½“" class="headerlink" title="å †çš„ç»“æ„ä½“"></a>å †çš„ç»“æ„ä½“</h3><p>é¦–å…ˆå®šä¹‰å †çš„ç»“æ„ä½“ï¼Œå †çš„æ•°æ®ç±»å‹éœ€è¦æ˜¯ä¸€ä¸ªåˆ‡ç‰‡ï¼ˆå®é™…ä»¥åˆ‡ç‰‡å½¢å¼å­˜å‚¨ï¼‰ï¼Œåˆ‡ç‰‡çš„ type å³ä¸ºå †çš„æ¯ä¸ªå…ƒç´ çš„æ•°æ®ç±»å‹ã€‚</p><ul><li><p>æœ€å¸¸ç”¨çš„æ•´æ•°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> IntHeap []<span class="keyword">int</span></span><br></pre></td></tr></table></figure></li><li><p>ä¹Ÿå¯ä½¿ç”¨ç»“æ„ä½“çš„åˆ‡ç‰‡ï¼Œæ¯”å¦‚æƒ³è¦å®ç°ä¸€ä¸ªæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªé•¿æ–¹ä½“çš„ä¼˜å…ˆé˜Ÿåˆ—</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Rectangle <span class="keyword">struct</span> &#123;</span><br><span class="line">width  <span class="keyword">int</span></span><br><span class="line">height <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> RectangleHeap []Rectangle</span><br></pre></td></tr></table></figure></li></ul><h3 id="Len-int"><a href="#Len-int" class="headerlink" title="Len() int"></a><code>Len() int</code></h3><p>ç”¨äºè¿”å›å †ä¸­å…ƒç´ çš„æ•°é‡ã€‚</p><p>å®ç°æ–¹å¼ç›¸å¯¹å›ºå®šï¼Œè¿”å›åˆ‡ç‰‡é•¿åº¦å³å¯ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h IntHeap)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">len</span>(h)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Less-i-j-int-bool"><a href="#Less-i-j-int-bool" class="headerlink" title="Less(i, j int) bool"></a><code>Less(i, j int) bool</code></h3><p>ç”¨äºè®¾ç½®å †çš„å…ƒç´ çš„å¤§å°æ¯”è¾ƒæ–¹æ³•ã€‚</p><p>æ¯”è¾ƒç´¢å¼•ä¸º <code>i</code> å’Œ <code>j</code> ä¸Šçš„ä¸¤ä¸ªå…ƒç´ ï¼Œå¦‚æœ <code>i</code> ç´¢å¼•å…ƒç´ åº”è¯¥æ’åœ¨ <code>j</code> çš„å‰é¢ï¼Œå³è¿”å› trueã€‚</p><ul><li>å°é¡¶å †ï¼š$h[i] &lt; h[j]$ï¼Œåˆ™è¿”å› true</li><li>å¤§é¡¶å †ï¼š$h[i] &gt; h[j]$ï¼Œåˆ™è¿”å› true</li></ul><p>ç¤ºä¾‹ï¼š</p><ul><li><p>æ•´æ•°å°é¡¶å †</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h IntHeap)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> h[i] &lt; h[j]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ•´æ•°å¤§é¡¶å †</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h IntHeap)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> h[i] &gt; h[j]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>é•¿æ–¹ä½“å¤§é¡¶å †ï¼Œé¢ç§¯æ¯”å¤§å°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r Rectangle)</span> <span class="title">area</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> r.width * r.height</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h RectangleHeap)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> h[i].area() &gt; h[j].area()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="Swap-i-j-int"><a href="#Swap-i-j-int" class="headerlink" title="Swap(i, j int)"></a><code>Swap(i, j int)</code></h3><p>ç”¨äºäº¤æ¢å †ä¸­ç´¢å¼• <code>i</code> å’Œ <code>j</code> ä½ç½®çš„å…ƒç´ ã€‚</p><p>å®ç°æ–¹å¼ç›¸å¯¹å›ºå®šï¼Œç›´æ¥äº¤æ¢äºŒè€…å­˜å‚¨ä½ç½®ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h IntHeap)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">h[i], h[j] = h[j], h[i]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Push-x-any"><a href="#Push-x-any" class="headerlink" title="Push(x any)"></a><code>Push(x any)</code></h3><p>å°†æ–°çš„å…ƒç´  x åŠ å…¥å †åˆ‡ç‰‡ï¼Œå³ append åˆ°æœ€åã€‚</p><p>æ³¨ï¼šæ¥å£çš„ <code>Push(x any)</code> åªéœ€è¦å°†æ–°å…ƒç´ åŠ åˆ°å †å°¾å³å¯ï¼Œä½¿ç”¨ <code>heap.Push()</code> æ—¶ï¼Œå°†ä¼šè°ƒç”¨ç”¨æˆ·å®ç°çš„  <code>Push(x any)</code> ï¼Œå°†å…ƒç´ åŠ åˆ°é˜Ÿå°¾ï¼Œç„¶åè‡ªåŠ¨å®ç°ä¸Šæµ®æ’åºã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *IntHeap)</span> <span class="title">Push</span><span class="params">(x any)</span></span> &#123;</span><br><span class="line">*h = <span class="built_in">append</span>(*h, x.(<span class="keyword">int</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Pop-any"><a href="#Pop-any" class="headerlink" title="Pop() any"></a><code>Pop() any</code></h3><p>ä»å †åˆ‡ç‰‡ä¸­ç§»é™¤æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›ã€‚</p><p>æ³¨ï¼šä½¿ç”¨ <code>heap.Pop()</code> æ—¶ï¼Œå°†å…ˆå°†å †é¡¶çš„å…ƒç´ ä¸‹æ²‰åˆ°é˜Ÿå°¾ï¼Œç„¶åè°ƒç”¨ç”¨æˆ·å®ç°çš„  <code>Pop() any</code>  åˆ é™¤å¹¶è¿”å›ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *IntHeap)</span> <span class="title">Pop</span><span class="params">()</span> <span class="title">any</span></span> &#123;</span><br><span class="line">n := <span class="built_in">len</span>(*h)</span><br><span class="line">x := (*h)[n<span class="number">-1</span>]</span><br><span class="line">*h = (*h)[:n<span class="number">-1</span>]</span><br><span class="line"><span class="keyword">return</span> x</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å®ç° <code>Push()</code> å’Œ <code>Pop()</code> æ—¶ï¼Œéƒ½éœ€ä½¿ç”¨æŒ‡é’ˆæ¥æ”¶ã€‚åˆ‡ç‰‡æ˜¯å¼•ç”¨ç±»å‹ï¼Œä½†åœ¨æ–¹æ³•ä¸­å¢åŠ /åˆ é™¤å…ƒç´ ï¼Œå¯èƒ½ä¼šä¿®æ”¹åˆ‡ç‰‡æœ¬èº«ï¼Œæ‰€ä»¥éœ€ä½¿ç”¨æŒ‡é’ˆæ¥æ”¶ã€‚</p></blockquote><h2 id="å †çš„ä½¿ç”¨"><a href="#å †çš„ä½¿ç”¨" class="headerlink" title="å †çš„ä½¿ç”¨"></a>å †çš„ä½¿ç”¨</h2><h3 id="heap-Init"><a href="#heap-Init" class="headerlink" title="heap.Init()"></a><code>heap.Init()</code></h3><p>ä½œç”¨ï¼šå®Œæˆå †çš„åˆå§‹åŒ–ã€‚è°ƒç”¨ç»“æŸåï¼Œå †çš„åˆ‡ç‰‡å³å®Œæˆæ’åºã€‚</p><p>å®ç°æ–¹å¼ï¼šå°†å †çš„éå¶å­èŠ‚ç‚¹ä¸€ä¸€ä¸‹æ²‰ã€‚ï¼ˆç”±åº•å‘ä¸Šï¼Œä»ç¬¬ä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹ä¸‹æ²‰ï¼Œç›´åˆ°å †é¡¶ï¼Œå¶å­èŠ‚ç‚¹æ²¡æœ‰ä¸‹æ²‰çš„å¿…è¦ï¼‰</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Init</span><span class="params">(h Interface)</span></span> &#123;</span><br><span class="line"><span class="comment">// heapify</span></span><br><span class="line">n := h.Len()</span><br><span class="line"><span class="keyword">for</span> i := n/<span class="number">2</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">down(h, i, n)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="heap-Push"><a href="#heap-Push" class="headerlink" title="heap.Push()"></a><code>heap.Push()</code></h3><p>ä½œç”¨ï¼šå°†æ–°å…ƒç´ æ¨å…¥å †ä¸­ï¼Œå¹¶å®Œæˆæ’åºã€‚</p><p>å®ç°æ–¹å¼ï¼šå…ˆè°ƒç”¨ç”¨æˆ·å®ç°çš„ <code>Push()</code> æ¥å£ï¼Œå°†æ–°å…ƒç´ åŠ å…¥åˆ‡ç‰‡çš„æœ€å°¾éƒ¨ï¼Œå†å°†å°¾éƒ¨ä¸Šæµ®ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Push</span><span class="params">(h Interface, x any)</span></span> &#123;</span><br><span class="line">h.Push(x)</span><br><span class="line">up(h, h.Len()<span class="number">-1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="heap-Pop"><a href="#heap-Pop" class="headerlink" title="heap.Pop()"></a><code>heap.Pop()</code></h3><p>ä½œç”¨ï¼šå°†å †é¡¶æ¨å‡ºå¹¶è¿”å›ã€‚</p><p>å®ç°æ–¹å¼ï¼šå…ˆå°†å †é¡¶å’Œå †å°¾äº¤æ¢ï¼Œå†å°†æ–°æ¢ä¸Šçš„å †é¡¶ä¸‹æ²‰ï¼Œæœ€åè°ƒç”¨ç”¨æˆ·å®ç°çš„ <code>Pop()</code> æ¥å£ï¼Œå°†å †å°¾æ¨å‡ºå¹¶è¿”å›ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Pop</span><span class="params">(h Interface)</span> <span class="title">any</span></span> &#123;</span><br><span class="line">n := h.Len() - <span class="number">1</span></span><br><span class="line">h.Swap(<span class="number">0</span>, n)</span><br><span class="line">down(h, <span class="number">0</span>, n)</span><br><span class="line"><span class="keyword">return</span> h.Pop()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h1><h2 id="æ»‘åŠ¨çª—å£æœ€å¤§å€¼"><a href="#æ»‘åŠ¨çª—å£æœ€å¤§å€¼" class="headerlink" title="æ»‘åŠ¨çª—å£æœ€å¤§å€¼"></a><a href="https://leetcode.cn/problems/sliding-window-maximum?envType=study-plan-v2&amp;envId=top-100-liked" target="_blank" rel="noopener">æ»‘åŠ¨çª—å£æœ€å¤§å€¼</a></h2><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code>ï¼Œæœ‰ä¸€ä¸ªå¤§å°ä¸º <code>k</code> çš„æ»‘åŠ¨çª—å£ä»æ•°ç»„çš„æœ€å·¦ä¾§ç§»åŠ¨åˆ°æ•°ç»„çš„æœ€å³ä¾§ã€‚ä½ åªå¯ä»¥çœ‹åˆ°åœ¨æ»‘åŠ¨çª—å£å†…çš„ <code>k</code> ä¸ªæ•°å­—ã€‚æ»‘åŠ¨çª—å£æ¯æ¬¡åªå‘å³ç§»åŠ¨ä¸€ä½ã€‚</p><p>è¿”å› <em>æ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼</em> ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums &#x3D; [1,3,-1,-3,5,3,6,7], k &#x3D; 3</span><br><span class="line">è¾“å‡ºï¼š[3,3,5,5,6,7]</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">æ»‘åŠ¨çª—å£çš„ä½ç½®                æœ€å¤§å€¼</span><br><span class="line">---------------               -----</span><br><span class="line">[1  3  -1] -3  5  3  6  7       3</span><br><span class="line"> 1 [3  -1  -3] 5  3  6  7       3</span><br><span class="line"> 1  3 [-1  -3  5] 3  6  7       5</span><br><span class="line"> 1  3  -1 [-3  5  3] 6  7       5</span><br><span class="line"> 1  3  -1  -3 [5  3  6] 7       6</span><br><span class="line"> 1  3  -1  -3  5 [3  6  7]      7</span><br></pre></td></tr></table></figure><p>ä¼˜å…ˆé˜Ÿåˆ—æ–¹æ³•é¢˜è§£ï¼š</p><ol><li>å°†å‰ k-1 ä¸ªæ•°å­—åˆå§‹åŒ–å¤§é¡¶å †</li><li>ä»ç¬¬ k ä¸ªæ•°å­—å¼€å§‹éå†<ol><li>å°†è¯¥æ•°å­— Push å…¥å †</li><li>æŸ¥çœ‹å †é¡¶å…ƒç´ <ul><li>å¦‚æœå·²ç»ä¸åœ¨æ»‘åŠ¨çª—å£é‡Œï¼Œåˆ™ Pop å‡ºå †</li><li>å¦åˆ™ï¼Œè¯¥å †é¡¶å³ä¸ºç°åœ¨æ»‘åŠ¨çª—å£é‡Œæœ€å¤§å…ƒç´ ï¼ŒåŠ å…¥ç»“æœ</li></ul></li></ol></li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> element <span class="keyword">struct</span> &#123;</span><br><span class="line">num   <span class="keyword">int</span></span><br><span class="line">index <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ElementHeap []element</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h ElementHeap)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">len</span>(h)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h ElementHeap)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> h[i].num &gt; h[j].num</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h ElementHeap)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">h[i], h[j] = h[j], h[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *ElementHeap)</span> <span class="title">Push</span><span class="params">(x any)</span></span> &#123;</span><br><span class="line">*h = <span class="built_in">append</span>(*h, x.(element))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *ElementHeap)</span> <span class="title">Pop</span><span class="params">()</span> <span class="title">any</span></span> &#123;</span><br><span class="line">n := h.Len()</span><br><span class="line">x := (*h)[n<span class="number">-1</span>]</span><br><span class="line">*h = (*h)[:n<span class="number">-1</span>]</span><br><span class="line"><span class="keyword">return</span> x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxSlidingWindow</span><span class="params">(nums []<span class="keyword">int</span>, k <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">h := &amp;ElementHeap&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; k<span class="number">-1</span>; i++ &#123;</span><br><span class="line">*h = <span class="built_in">append</span>(*h, element&#123;</span><br><span class="line">num:   nums[i],</span><br><span class="line">index: i,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">heap.Init(h)</span><br><span class="line">ans := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="built_in">len</span>(nums))</span><br><span class="line"><span class="keyword">for</span> i := k - <span class="number">1</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">heap.Push(h, element&#123;</span><br><span class="line">num:   nums[i],</span><br><span class="line">index: i,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (*h)[<span class="number">0</span>].index &lt; i-k+<span class="number">1</span> &#123;</span><br><span class="line">heap.Pop(h)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">ans = <span class="built_in">append</span>(ans, (*h)[<span class="number">0</span>].num)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;å †ï¼ˆheapï¼‰æ˜¯ä¸€ç§æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„å®Œå…¨äºŒå‰æ ‘ï¼Œåˆ†ä¸ºå¤§é¡¶å †å’Œå°é¡¶å †ï¼Œé€šå¸¸ç”¨äºå®ç°ä¼˜å…ˆé˜Ÿåˆ—ï¼Œè¿›è¡Œå †æ’åºã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»æ¨æ•°æ®ç»“æ„ä»¥åŠå…¶ Go å®ç°ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ç®—æ³•" scheme="https://gy23333.github.io/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="ç®—æ³•" scheme="https://gy23333.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
    <category term="å †" scheme="https://gy23333.github.io/tags/%E5%A0%86/"/>
    
  </entry>
  
  <entry>
    <title>OpenTelemetryåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª</title>
    <link href="https://gy23333.github.io/2025/01/06/OpenTelemetry%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/"/>
    <id>https://gy23333.github.io/2025/01/06/OpenTelemetry%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/</id>
    <published>2025-01-05T16:37:19.000Z</published>
    <updated>2025-01-06T17:48:25.073Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><a href="https://jckling.github.io/2021/04/02/Jaeger/å…¨é“¾è·¯è¿½è¸ªä¸%20Jaeger%20å…¥é—¨/index.html" target="_blank" rel="noopener">https://jckling.github.io/2021/04/02/Jaeger/å…¨é“¾è·¯è¿½è¸ªä¸%20Jaeger%20å…¥é—¨/index.html</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name jaeger   -e COLLECTOR_ZIPKIN_HTTP_PORT&#x3D;9411   -p 5775:5775&#x2F;udp   -p 6831:6831&#x2F;udp   -p 6832:6832&#x2F;udp   -p 5778:5778   -p 16686:16686   -p 14268:14268   -p 14250:14250   -p 9411:9411   quay.io&#x2F;jaegertracing&#x2F;all-in-one:1.64.0</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>TLS è¯ä¹¦</title>
    <link href="https://gy23333.github.io/2024/12/24/TLS-%E8%AF%81%E4%B9%A6/"/>
    <id>https://gy23333.github.io/2024/12/24/TLS-%E8%AF%81%E4%B9%A6/</id>
    <published>2024-12-24T14:55:05.000Z</published>
    <updated>2025-05-08T05:39:32.460Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Go ç¯å¢ƒé…ç½®</title>
    <link href="https://gy23333.github.io/2024/12/24/Go-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    <id>https://gy23333.github.io/2024/12/24/Go-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</id>
    <published>2024-12-23T17:18:11.000Z</published>
    <updated>2025-07-10T17:58:15.605Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>Go ç¯å¢ƒé…ç½®</p><a id="more"></a><h1 id="Go-å®‰è£…"><a href="#Go-å®‰è£…" class="headerlink" title="Go å®‰è£…"></a>Go å®‰è£…</h1><p>Ubuntu ç›´æ¥ä½¿ç”¨ apt å®‰è£… Golang</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install golang</span><br></pre></td></tr></table></figure><h1 id="Go-ç‰ˆæœ¬ç®¡ç†"><a href="#Go-ç‰ˆæœ¬ç®¡ç†" class="headerlink" title="Go ç‰ˆæœ¬ç®¡ç†"></a>Go ç‰ˆæœ¬ç®¡ç†</h1><p>Go ç‰ˆæœ¬ç®¡ç†å·¥å…· <a href="https://github.com/moovweb/gvm" target="_blank" rel="noopener">gvm</a> ç®¡ç†å¤šä¸ªç‰ˆæœ¬çš„ Golang</p><h2 id="gvm-å®‰è£…"><a href="#gvm-å®‰è£…" class="headerlink" title="gvm å®‰è£…"></a>gvm å®‰è£…</h2><ol><li><p>å®‰è£… bison</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install bison</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£… gvm</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt; &lt;(curl -s -S -L https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;moovweb&#x2F;gvm&#x2F;master&#x2F;binscripts&#x2F;gvm-installer)</span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ ç¯å¢ƒå˜é‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source &#x2F;root&#x2F;.gvm&#x2F;scripts&#x2F;gvm</span><br></pre></td></tr></table></figure></li></ol><h2 id="gvm-ç®¡ç†å¤šä¸ª-go-ç‰ˆæœ¬"><a href="#gvm-ç®¡ç†å¤šä¸ª-go-ç‰ˆæœ¬" class="headerlink" title="gvm ç®¡ç†å¤šä¸ª go ç‰ˆæœ¬"></a>gvm ç®¡ç†å¤šä¸ª go ç‰ˆæœ¬</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2404:~&#x2F;.gvm&#x2F;scripts# gvm help</span><br><span class="line">Usage: gvm [command]</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">  GVM is the Go Version Manager</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  version    - print the gvm version number</span><br><span class="line">  get        - gets the latest code (for debugging)</span><br><span class="line">  use        - select a go version to use (--default to set permanently)</span><br><span class="line">  diff       - view changes to Go root</span><br><span class="line">  help       - display this usage text</span><br><span class="line">  implode    - completely remove gvm</span><br><span class="line">  install    - install go versions</span><br><span class="line">  uninstall  - uninstall go versions</span><br><span class="line">  cross      - install go cross compilers</span><br><span class="line">  linkthis   - link this directory into GOPATH</span><br><span class="line">  list       - list installed go versions</span><br><span class="line">  listall    - list available versions</span><br><span class="line">  alias      - manage go version aliases</span><br><span class="line">  pkgset     - manage go packages sets</span><br><span class="line">  pkgenv     - edit the environment for a package set</span><br><span class="line">  applymod   - apply the go version in go.mod</span><br></pre></td></tr></table></figure><ul><li><p>æŸ¥çœ‹å·²ä¸‹è½½ go ç‰ˆæœ¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gvm list</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å¯ä¸‹è½½ go ç‰ˆæœ¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gvm listall</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…ç‰¹å®š go ç‰ˆæœ¬ï¼ˆgvm å®‰è£… go ç‰ˆæœ¬éœ€è¦å…ˆå®‰è£…ä¸€ä¸ªåŸºç¡€çš„ goï¼Œgo ç‰ˆæœ¬å…·ä½“çœ‹æŠ¥é”™æç¤ºï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gvm install go1.24.2</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬çš„ go</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gvm use go1.24.2</span><br></pre></td></tr></table></figure></li></ul><h1 id="åˆå§‹åŒ–-Go-é¡¹ç›®"><a href="#åˆå§‹åŒ–-Go-é¡¹ç›®" class="headerlink" title="åˆå§‹åŒ– Go é¡¹ç›®"></a>åˆå§‹åŒ– Go é¡¹ç›®</h1><ol><li><p>æ–°å»ºé¡¹ç›®æ–‡ä»¶å¤¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir survey-test</span><br><span class="line">cd survey-test</span><br></pre></td></tr></table></figure></li><li><p>åˆå§‹åŒ– Go æ¨¡å—</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go mod init github.com/GY23333/survey<span class="literal">-test</span></span><br><span class="line">go: creating new go.mod: module github.com/GY23333/survey<span class="literal">-test</span></span><br></pre></td></tr></table></figure><p>è¯¥æ­¥ä¼šè‡ªåŠ¨ç”Ÿæˆ go.mod æ–‡ä»¶</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">module github.com/GY23333/survey-test</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="number">1.23</span><span class="number">.3</span></span><br></pre></td></tr></table></figure></li><li><p>å¦‚éœ€è·å–ä¾èµ–</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com&#x2F;gorilla&#x2F;mux</span><br></pre></td></tr></table></figure></li><li></li></ol><h1 id="VSCode-Go-é…ç½®"><a href="#VSCode-Go-é…ç½®" class="headerlink" title="VSCode Go é…ç½®"></a>VSCode Go é…ç½®</h1><h2 id="Go-ä»£ç è¡¥å…¨"><a href="#Go-ä»£ç è¡¥å…¨" class="headerlink" title="Go ä»£ç è¡¥å…¨"></a>Go ä»£ç è¡¥å…¨</h2><p>éœ€å®‰è£… gopls</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go install golang.org/x/tools/gopls@latest</span><br></pre></td></tr></table></figure><h1 id="å…¶ä»–é…ç½®"><a href="#å…¶ä»–é…ç½®" class="headerlink" title="å…¶ä»–é…ç½®"></a>å…¶ä»–é…ç½®</h1><h2 id="GoProxy"><a href="#GoProxy" class="headerlink" title="GoProxy"></a>GoProxy</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go env -w GOPROXY=https://mirrors.aliyun.com/goproxy/,direct</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;Go ç¯å¢ƒé…ç½®&lt;/p&gt;</summary>
    
    
    
    <category term="Golang" scheme="https://gy23333.github.io/categories/Golang/"/>
    
    
    <category term="Golang" scheme="https://gy23333.github.io/tags/Golang/"/>
    
  </entry>
  
  <entry>
    <title>Go Package: survey</title>
    <link href="https://gy23333.github.io/2024/12/24/Go-Package-survey/"/>
    <id>https://gy23333.github.io/2024/12/24/Go-Package-survey/</id>
    <published>2024-12-23T16:44:26.000Z</published>
    <updated>2024-12-25T18:09:26.971Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>Go äº¤äº’å¼å‘½ä»¤è¡Œå·¥å…·åº“ï¼Œæä¾›äº†åŒ…æ‹¬æ–‡æœ¬è¾“å…¥ã€é€‰æ‹©èœå•ã€ç¡®è®¤æç¤ºã€å¤šé¡¹é€‰æ‹©ç­‰å¤šç§äº¤äº’ç±»å‹ï¼Œå¸®åŠ©å¿«é€Ÿæ„å»ºäº¤äº’å¼å‘½ä»¤è¡Œé¡µé¢ã€‚</p><a id="more"></a><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com&#x2F;AlecAivazis&#x2F;survey&#x2F;v2</span><br></pre></td></tr></table></figure><h1 id="Prompt"><a href="#Prompt" class="headerlink" title="Prompt"></a>Prompt</h1><h2 id="Input-å•è¡Œè¾“å…¥"><a href="#Input-å•è¡Œè¾“å…¥" class="headerlink" title="Input å•è¡Œè¾“å…¥"></a>Input å•è¡Œè¾“å…¥</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> username <span class="keyword">string</span></span><br><span class="line">prompt := &amp;survey.Input&#123;</span><br><span class="line">  Message: <span class="string">"Input username:"</span>,</span><br><span class="line">&#125;</span><br><span class="line">survey.AskOne(prompt, &amp;username)</span><br></pre></td></tr></table></figure><p><img src="https://gy-pic.oss-cn-hangzhou.aliyuncs.com/image-20241225015619560.png" alt="image-20241225015619560" style="zoom:67%;" /></p><p>å¯ä»¥é€šè¿‡è®¾ç½® <code>Suggest</code> æ¥ç»™ç”¨æˆ·æä¾›å»ºè®®ï¼Œå¸®åŠ©è¡¥å…¨è¾“å…¥ï¼Œ<code>Suggest</code> ä¸ºç”±å½“å‰è¾“å…¥å€¼è¿”å›å»ºè®®å€¼åˆ—è¡¨çš„æ–¹æ³•ã€‚å¦‚ä¸‹é¢è¡¥å…¨æ–‡ä»¶è·¯å¾„ç¤ºä¾‹ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path <span class="keyword">string</span></span><br><span class="line">prompt := &amp;survey.Input&#123;</span><br><span class="line">  Message: <span class="string">"Input file path:"</span>,</span><br><span class="line">  Suggest: <span class="function"><span class="keyword">func</span><span class="params">(toComplete <span class="keyword">string</span>)</span> []<span class="title">string</span></span> &#123;</span><br><span class="line">    files, _ := filepath.Glob(toComplete + <span class="string">"*"</span>)</span><br><span class="line">    <span class="keyword">return</span> files</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">survey.AskOne(prompt, &amp;path)</span><br></pre></td></tr></table></figure><p><img src="https://gy-pic.oss-cn-hangzhou.aliyuncs.com/image-20241225020920573.png" alt=""></p><h2 id="Multiline-å¤šè¡Œè¾“å…¥"><a href="#Multiline-å¤šè¡Œè¾“å…¥" class="headerlink" title="Multiline å¤šè¡Œè¾“å…¥"></a>Multiline å¤šè¡Œè¾“å…¥</h2><h2 id="Select-å•é€‰"><a href="#Select-å•é€‰" class="headerlink" title="Select å•é€‰"></a>Select å•é€‰</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tool <span class="keyword">string</span></span><br><span class="line">prompt := &amp;survey.Select&#123;</span><br><span class="line">  Message: <span class="string">"Choose a tool:"</span>,</span><br><span class="line">  Options: []<span class="keyword">string</span>&#123;<span class="string">"toolA"</span>, <span class="string">"toolB"</span>, <span class="string">"toolC"</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line">survey.AskOne(prompt, &amp;tool)</span><br></pre></td></tr></table></figure><p><img src="https://gy-pic.oss-cn-hangzhou.aliyuncs.com/image-20241225013809541.png" style="zoom: 67%;" /></p><p>å¯ä»¥é€šè¿‡è®¾ç½® <code>Description</code> ç»™æ¯ä¸ªé€‰é¡¹æ·»åŠ æè¿°ï¼Œ <code>Description</code>  ä¸ºç”±é€‰é¡¹å€¼/åºå·è¿”å›æè¿°çš„æ–¹æ³•</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tool <span class="keyword">string</span></span><br><span class="line">description := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;</span><br><span class="line">  <span class="string">"toolA"</span>: <span class="string">"Description for toolA"</span>,</span><br><span class="line">  <span class="string">"toolB"</span>: <span class="string">"Description for toolB"</span>,</span><br><span class="line">  <span class="string">"toolC"</span>: <span class="string">"Description for toolC"</span>,</span><br><span class="line">&#125;</span><br><span class="line">prompt := &amp;survey.Select&#123;</span><br><span class="line">  Message: <span class="string">"Choose a tool:"</span>,</span><br><span class="line">  Options: []<span class="keyword">string</span>&#123;<span class="string">"toolA"</span>, <span class="string">"toolB"</span>, <span class="string">"toolC"</span>&#125;,</span><br><span class="line">  Description: <span class="function"><span class="keyword">func</span><span class="params">(value <span class="keyword">string</span>, index <span class="keyword">int</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> description[value]</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">survey.AskOne(prompt, &amp;tool)</span><br></pre></td></tr></table></figure><p><img src="https://gy-pic.oss-cn-hangzhou.aliyuncs.com/image-20241225014328295.png" style="zoom:67%;" /></p><h2 id="MultiSelect-å¤šé€‰"><a href="#MultiSelect-å¤šé€‰" class="headerlink" title="MultiSelect å¤šé€‰"></a>MultiSelect å¤šé€‰</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">days := []<span class="keyword">string</span>&#123;&#125;</span><br><span class="line">prompt := &amp;survey.MultiSelect&#123;</span><br><span class="line">    Message: <span class="string">"What days do you prefer:"</span>,</span><br><span class="line">    Options: []<span class="keyword">string</span>&#123;<span class="string">"Sunday"</span>, <span class="string">"Monday"</span>, <span class="string">"Tuesday"</span>, <span class="string">"Wednesday"</span>, <span class="string">"Thursday"</span>, <span class="string">"Friday"</span>, <span class="string">"Saturday"</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line">survey.AskOne(prompt, &amp;days)</span><br></pre></td></tr></table></figure><p><img src="https://gy-pic.oss-cn-hangzhou.aliyuncs.com/image-20241226000302861.png" alt="image-20241226000302861"></p><h2 id="Confirm-ç¡®è®¤"><a href="#Confirm-ç¡®è®¤" class="headerlink" title="Confirm ç¡®è®¤"></a>Confirm ç¡®è®¤</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">answer := <span class="literal">false</span></span><br><span class="line">prompt := &amp;survey.Confirm&#123;</span><br><span class="line">  Message: <span class="string">"Are you sure to continue?"</span>,</span><br><span class="line">&#125;</span><br><span class="line">survey.AskOne(prompt, &amp;answer)</span><br></pre></td></tr></table></figure><p><img src="https://gy-pic.oss-cn-hangzhou.aliyuncs.com/image-20241226004601642.png" alt="image-20241226004601642" style="zoom:67%;" /></p><h2 id="Password-å¯†ç "><a href="#Password-å¯†ç " class="headerlink" title="Password å¯†ç "></a>Password å¯†ç </h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">password := <span class="string">""</span></span><br><span class="line">prompt := &amp;survey.Password&#123;</span><br><span class="line">  Message: <span class="string">"Please type your password"</span>,</span><br><span class="line">&#125;</span><br><span class="line">survey.AskOne(prompt, &amp;password)</span><br></pre></td></tr></table></figure><p><img src="https://gy-pic.oss-cn-hangzhou.aliyuncs.com/image-20241226004825233.png" alt="image-20241226004825233" style="zoom:67%;" /></p><h1 id="Option"><a href="#Option" class="headerlink" title="Option"></a>Option</h1><h2 id="Validator"><a href="#Validator" class="headerlink" title="Validator"></a>Validator</h2><p>è®¾ç½®è¾“å…¥éªŒè¯ï¼Œæä¾›è¾“å…¥éªŒè¯å‡½æ•°ï¼ˆè¾“å…¥ï¼šè¾“å…¥å€¼ï¼Œè¿”å› errorï¼‰ï¼Œå¦‚æœç”¨æˆ·è¾“å…¥éªŒè¯ä¸é€šè¿‡ï¼Œåˆ™æç¤ºé”™è¯¯ï¼Œå¹¶é‡æ–°æé—®ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> input <span class="keyword">string</span></span><br><span class="line">prompt := &amp;survey.Input&#123;</span><br><span class="line">  Message: <span class="string">"Input number:"</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// éªŒè¯è¾“å…¥ä¸ºæ•°å­—ï¼Œå¹¶åœ¨0åˆ°10èŒƒå›´å†…</span></span><br><span class="line">vaildInputNumber := <span class="function"><span class="keyword">func</span><span class="params">(val <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">  num, err := strconv.Atoi(val.(<span class="keyword">string</span>))</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(<span class="string">"not number"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> num &lt; <span class="number">0</span> || num &gt; <span class="number">10</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(<span class="string">"not in 0~10"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">survey.AskOne(prompt, &amp;input, survey.WithValidator(vaildInputNumber))</span><br></pre></td></tr></table></figure><p><img src="https://gy-pic.oss-cn-hangzhou.aliyuncs.com/image-20241226013939360.png" alt="image-20241226013939360" style="zoom:67%;" /></p><p>Survey åº“ä¹Ÿæä¾›äº†ä¸€äº›å¯ç›´æ¥è°ƒç”¨çš„éªŒè¯å‡½æ•°</p><ul><li><code>Required</code>ï¼šè¦æ±‚éç©º</li><li><code>MinLength(n)</code>ï¼šæœ€å°é•¿åº¦</li><li><code>MaxLength(n)ï¼šæœ€å¤§é•¿åº¦</code></li></ul><h1 id="Ask"><a href="#Ask" class="headerlink" title="Ask"></a>Ask</h1><p><code>Ask</code>æ”¯æŒè¿ç»­é—®å¤šä¸ªé—®é¢˜ï¼Œè®¾ç½®å¤šä¸ªé—®é¢˜ï¼Œæ¯ä¸ªé—®é¢˜å¯ä»¥åŒ…æ‹¬å››ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><code>Name</code>ï¼šä¸å›ç­”ç»“æ„ä½“é‡Œçš„å…ƒç´ å¯¹åº”ï¼Œç”¨äºæŒ‡åç»“æœè§£æåˆ°å“ªä¸ªå…ƒç´ </li><li><code>Prompt</code>ï¼šå…·ä½“çš„é—®é¢˜</li><li><code>Vaildate</code>ï¼šå›ç­”çš„éªŒè¯æ–¹æ³•</li><li><code>Transform</code>ï¼šè‡ªåŠ¨æ›´æ”¹æ ¼å¼</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">qs := []*survey.Question&#123;</span><br><span class="line">  &#123;</span><br><span class="line">    Name:      <span class="string">"name"</span>,</span><br><span class="line">    Prompt:    &amp;survey.Input&#123;Message: <span class="string">"What is your name?"</span>&#125;,</span><br><span class="line">    Validate:  survey.Required,</span><br><span class="line">    Transform: survey.Title,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    Name: <span class="string">"color"</span>,</span><br><span class="line">    Prompt: &amp;survey.Select&#123;</span><br><span class="line">      Message: <span class="string">"Choose a color:"</span>,</span><br><span class="line">      Options: []<span class="keyword">string</span>&#123;<span class="string">"red"</span>, <span class="string">"blue"</span>, <span class="string">"green"</span>&#125;,</span><br><span class="line">      Default: <span class="string">"red"</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    Name:   <span class="string">"age"</span>,</span><br><span class="line">    Prompt: &amp;survey.Input&#123;Message: <span class="string">"How old are you?"</span>&#125;,</span><br><span class="line">    Validate: <span class="function"><span class="keyword">func</span><span class="params">(val <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">      _, err := strconv.Atoi(val.(<span class="keyword">string</span>))</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">"not number"</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">answers := <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name          <span class="keyword">string</span> <span class="comment">// survey will match the question and field names</span></span><br><span class="line">  FavoriteColor <span class="keyword">string</span> <span class="string">`survey:"color"`</span> <span class="comment">// or you can tag fields to match a specific name</span></span><br><span class="line">  Age           <span class="keyword">int</span>    <span class="comment">// if the types don't match, survey will convert it</span></span><br><span class="line">&#125;&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// perform the questions</span></span><br><span class="line">err := survey.Ask(qs, &amp;answers)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  fmt.Println(err.Error())</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gy-pic.oss-cn-hangzhou.aliyuncs.com/image-20241226020405076.png" alt="image-20241226020405076" style="zoom:67%;" /></p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><a href="https://github.com/AlecAivazis/survey" target="_blank" rel="noopener">https://github.com/AlecAivazis/survey</a></li><li><a href="https://pkg.go.dev/github.com/AlecAivazis/survey/v2#section-readme" target="_blank" rel="noopener">https://pkg.go.dev/github.com/AlecAivazis/survey/v2#section-readme</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;Go äº¤äº’å¼å‘½ä»¤è¡Œå·¥å…·åº“ï¼Œæä¾›äº†åŒ…æ‹¬æ–‡æœ¬è¾“å…¥ã€é€‰æ‹©èœå•ã€ç¡®è®¤æç¤ºã€å¤šé¡¹é€‰æ‹©ç­‰å¤šç§äº¤äº’ç±»å‹ï¼Œå¸®åŠ©å¿«é€Ÿæ„å»ºäº¤äº’å¼å‘½ä»¤è¡Œé¡µé¢ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Golang" scheme="https://gy23333.github.io/categories/Golang/"/>
    
    
    <category term="Golang" scheme="https://gy23333.github.io/tags/Golang/"/>
    
  </entry>
  
</feed>
